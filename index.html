<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Der Flow - Vom Einkommen zum Verm√∂gen</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata@2.2.5"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
</head>

<body class="theme-dark" id="theme-root">

    <a class="skip-link" href="#main-content">Zum Hauptinhalt springen</a>

    <main id="main-content" class="max-w-screen-2xl mx-auto" tabindex="-1">
        <header class="text-center mb-12 mt-6">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-2 app-heading" style="letter-spacing: -0.02em;">Der Flow
            </h1>
            <p class="text-md md:text-lg app-subheading font-light" style="letter-spacing: 0.04em;">Vom Einkommen zum
                Investment</p>
        </header>

        <!-- v1.4.0: Sidebar entfernt - Controls in Modals/FAB integriert -->
        <div class="w-full">
            <!-- v1.4.0: Control Bar (Top Right) -->
            <div id="control-bar" class="fixed top-4 right-4 z-50 flex items-center gap-2">
                <!-- Theme Toggle -->
                <label class="control-chip control-chip--toggle" title="Darstellung wechseln">
                    <input type="checkbox" id="theme-switch" aria-label="Theme umschalten (Hell/Dunkel)" />
                    <span class="chip-icon" aria-hidden="true">
                        <svg class="icon icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="4" />
                            <path d="M12 2v2" />
                            <path d="M12 20v2" />
                            <path d="M4.93 4.93l1.42 1.42" />
                            <path d="M17.65 17.65l1.42 1.42" />
                            <path d="M2 12h2" />
                            <path d="M20 12h2" />
                            <path d="M4.93 19.07l1.42-1.42" />
                            <path d="M17.65 6.35l1.42-1.42" />
                        </svg>
                        <svg class="icon icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z" />
                        </svg>
                    </span>
                </label>

                <!-- Variant Toggle -->
                <label class="control-chip control-chip--variant" title="Variante A/B umschalten">
                    <input type="checkbox" id="variant-switch" aria-label="Variante A/B umschalten">
                    <span class="chip-pair" aria-hidden="true">
                        <span id="variante-a-label" class="chip-state chip-state--active">A</span>
                        <span id="variante-b-label" class="chip-state">B</span>
                    </span>
                </label>

                <!-- Consultation Toggle -->
                <div class="control-chip control-chip--consultation" title="Beratung">
                    <button id="consult-toggle-btn" class="chip-button" type="button" aria-label="Beratung starten">
                        <svg class="icon icon-mlp" viewBox="0 0 24 24" aria-hidden="true">
                            <circle cx="10" cy="12" r="5.5" stroke="currentColor" stroke-width="1.6" fill="none" />
                            <path d="M10 8.5v7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                            <path d="M18 7h3v10h-3z" fill="currentColor" />
                        </svg>
                    </button>
                    <button id="consult-next-btn" class="chip-button hidden" type="button"
                        aria-label="Weiter zur naechsten Beratungsphase" title="Weiter zur naechsten Beratungsphase">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 12h14" />
                            <path d="M13 6l6 6-6 6" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- v1.4.0: Hidden input fields for global inputs reference -->
            <div style="display: none;">
                <input type="number" id="income" value="3000">
                <input type="number" id="konsumMin" value="100">
                <input type="number" id="konsumLeftover" value="250">
                <input type="number" id="tagesgeldCurrent" value="4800">
                <input type="number" id="tagesgeldLimit" value="5000">
                <input type="number" id="depotCurrent-hidden" value="0">
                <input type="number" id="anlagezeitraum-hidden" value="15" min="1" max="40">
                <input type="number" id="rendite-hidden" value="7.0" step="0.1">
            </div>

            <div id="flow-container" class="w-full relative min-h-[1150px]">
                <!-- Mobile Warning Overlay -->
                <div id="mobile-warning" class="no-print">
                    <div class="warning-content">
                        <div class="warning-icon">üì±</div>
                        <h3>Desktop empfohlen</h3>
                        <p>
                            Die Flowchart-Visualisierung ist f√ºr gr√∂√üere Bildschirme optimiert.
                            <br><br>
                            <strong>Verf√ºgbar auf Mobile:</strong><br>
                            ‚úì Eingaben & Berechnungen<br>
                            ‚úì Export-Funktionen (PDF, CSV, JSON, Excel)<br>
                            ‚úì Session-Verwaltung
                        </p>
                        <button onclick="document.getElementById('mobile-warning').style.display='none'"
                            class="btn-mobile">
                            Verstanden
                        </button>
                    </div>
                </div>
                <svg id="flow-svg" class="flow-svg">
                    <defs>
                        <linearGradient id="flow-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#3b82f6" />
                            <stop offset="100%" stop-color="#6366f1" />
                        </linearGradient>
                        <filter id="flow-glow" x="-50%" y="-50%" width="200%" height="200%">
                            <feGaussianBlur stdDeviation="3" result="blur" />
                            <feMerge>
                                <feMergeNode in="blur" />
                                <feMergeNode in="SourceGraphic" />
                            </feMerge>
                        </filter>
                        <mask id="flow-mask" maskUnits="userSpaceOnUse">
                            <rect x="0" y="0" width="100%" height="100%" fill="black"></rect>
                            <path id="flow-path-1-mask" class="flow-mask-stroke"></path>
                            <path id="flow-path-2-mask" class="flow-mask-stroke"></path>
                            <path id="konsum-tagesgeld-flow-mask" class="flow-mask-stroke"></path>
                            <path id="tagesgeld-depot-flow-mask" class="flow-mask-stroke"></path>
                            <path id="fixkosten-depot-flow-mask" class="flow-mask-stroke"></path>
                            <path id="vermieterkonto-einkommen-flow-mask" class="flow-mask-stroke"></path>
                            <path id="fixkosten-vermieterkonto-flow-mask" class="flow-mask-stroke"></path>
                        </mask>
                    </defs>
                    <g id="flow-visuals" mask="url(#flow-mask)">
                        <!-- Deficitline ganz hinten (erstes Element = hinterste Ebene) -->
                        <path id="fixkosten-vermieterkonto-flow-erase" class="flow-erase"></path>
                        <path id="fixkosten-vermieterkonto-flow" class="flow-path"></path>
                        <path id="fixkosten-vermieterkonto-flow-anim" class="flow-path-animation"></path>
                        <g id="fixkosten-vermieterkonto-flow-dot"></g>
                        <!-- Normale Flows -->
                        <path id="flow-path-1-erase" class="flow-erase"></path>
                        <path id="flow-path-1" class="flow-path"></path>
                        <path id="flow-path-1-anim" class="flow-path-animation"></path>
                        <g id="flow-path-1-dot"></g>
                        <path id="flow-path-2-erase" class="flow-erase"></path>
                        <path id="flow-path-2" class="flow-path"></path>
                        <path id="flow-path-2-anim" class="flow-path-animation"></path>
                        <g id="flow-path-2-dot"></g>
                        <path id="konsum-tagesgeld-flow-erase" class="flow-erase"></path>
                        <path id="konsum-tagesgeld-flow" class="flow-path"></path>
                        <path id="konsum-tagesgeld-flow-anim" class="flow-path-animation"></path>
                        <g id="konsum-tagesgeld-flow-dot"></g>
                        <path id="tagesgeld-depot-flow-erase" class="flow-erase"></path>
                        <path id="tagesgeld-depot-flow" class="flow-path"></path>
                        <path id="tagesgeld-depot-flow-anim" class="flow-path-animation"></path>
                        <g id="tagesgeld-depot-flow-dot"></g>
                        <path id="fixkosten-depot-flow-erase" class="flow-erase"></path>
                        <path id="fixkosten-depot-flow" class="flow-path"></path>
                        <path id="fixkosten-depot-flow-anim" class="flow-path-animation"></path>
                        <g id="fixkosten-depot-flow-dot"></g>
                        <!-- Vermieterkonto positive Flow -->
                        <path id="vermieterkonto-einkommen-flow-erase" class="flow-erase"></path>
                        <path id="vermieterkonto-einkommen-flow" class="flow-path"></path>
                        <path id="vermieterkonto-einkommen-flow-anim" class="flow-path-animation"></path>
                        <g id="vermieterkonto-einkommen-flow-dot"></g>
                    </g>
                    <path id="schutzschirm-path" class="schutzschirm"></path>
                </svg>

                <!-- v1.6.1 Level 2: Hover-Tooltip (compact, visual connection) -->
                <div id="schutzschild-tooltip" class="schutzschild-tooltip">
                    <div class="schutzschild-tooltip-puffer">
                        <span class="schutzschild-tooltip-icon">üõ°Ô∏è</span>
                        <span id="tooltip-puffer-text" class="schutzschild-tooltip-puffer-text">Puffer: 4 M</span>
                    </div>
                </div>

                <!-- SVG connection line: Tagesgeld ‚Üí THROUGH Tooltip ‚Üí Shield (line goes OVER tooltip, making it look like it passes through) -->
                <svg id="tooltip-connection-svg"
                    style="position: absolute; pointer-events: none; z-index: 115; display: none;">
                    <path id="tagesgeld-tooltip-line" class="tooltip-connection-line" stroke="rgba(16, 185, 129, 0.9)"
                        fill="none" />
                </svg>

                <!-- Horizontal Gradient Zones f√ºr visuelle Ebenen-Trennung -->
                <div id="gradient-zone-1" class="gradient-zone gradient-zone-1" style="top: 0; height: 240px;"></div>
                <div id="gradient-zone-2" class="gradient-zone gradient-zone-2" style="top: 240px; height: 480px;">
                </div>
                <div id="gradient-zone-3" class="gradient-zone gradient-zone-3" style="top: 720px; height: 240px;">
                </div>
                <div id="gradient-zone-4" class="gradient-zone gradient-zone-4" style="top: 960px; height: 300px;">
                </div>

                <div id="einkommen-basin" class="account-basin account-basin--editable"></div>
                <button id="fixkosten-basin" class="account-basin cursor-pointer hover:border-indigo-500" type="button"
                    aria-controls="fixkosten-modal" aria-haspopup="dialog" onclick="openFixkostenModal()"></button>
                <div id="konsum-basin" class="account-basin account-basin--editable"></div>
                <div id="tagesgeld-basin" class="account-basin account-basin--editable"></div>
                <button id="depot-basin" class="account-basin cursor-pointer hover:border-purple-500" type="button"
                    aria-controls="depot-modal" aria-haspopup="dialog"
                    onclick="updateRenditeSuggestions(parseInt(document.getElementById('anlagezeitraum').value, 10)); openModal('depot-modal');"></button>
                <button id="vermieterkonto-basin" class="account-basin cursor-pointer hover:border-mlp-blue"
                    type="button" aria-controls="vermieterkonto-modal" aria-haspopup="dialog"
                    onclick="loadVermieterkontoData(); openModal('vermieterkonto-modal')"
                    style="height: 140px;"></button>
                <button id="immobilien-basin" class="account-basin cursor-pointer hover:border-amber-500" type="button"
                    aria-controls="immobilien-modal" aria-haspopup="dialog"
                    onclick="openModal('immobilien-modal')"></button>
            </div>

            <!-- v1.7.3: Buchungs-Timeline -->
            <div id="booking-timeline-container" class="booking-timeline-container mt-6 no-print">
                <div class="booking-timeline-header">
                    <div class="flex items-center gap-2">
                        <span class="text-sm font-semibold text-gray-400">üìÖ Buchungsablauf im Monat</span>
                    </div>
                    <button onclick="openBookingModal()" class="booking-timeline-edit-btn"
                        title="Buchungskalender bearbeiten">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                        Bearbeiten
                    </button>
                </div>
                <div id="booking-timeline" class="booking-timeline">
                    <!-- Timeline wird dynamisch bef√ºllt -->
                    <div class="booking-timeline-empty">
                        <span class="text-gray-500 text-sm">Keine Buchungen geplant</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="printable-report"></div>

    <!-- Modals -->

    <div id="prognose-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-[60]"
        role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="prognose-modal-title"
        aria-describedby="prognose-summary">
        <div class="bg-secondary w-full max-w-3xl rounded-xl shadow-2xl p-6 relative" role="document" tabindex="-1">
            <button type="button" onclick="closeModal('prognose-modal')"
                class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl"
                aria-label="Prognose schlie√üen">&times;</button>
            <h3 id="prognose-modal-title" class="text-xl font-bold mb-4">Prognose: Verm√∂gensentwicklung</h3>
            <div class="bg-primary p-4 rounded-lg">
                <canvas id="prognose-chart"></canvas>
            </div>
            <div id="prognose-summary" class="mt-4 text-center"></div>
        </div>
    </div>
    </div>

    <div id="fixkosten-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-50"
        role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="fixkosten-modal-title">
        <div class="bg-secondary w-full max-w-3xl rounded-xl shadow-2xl p-6 md:p-8 relative" role="document"
            tabindex="-1">
            <button type="button" onclick="closeModal('fixkosten-modal')"
                class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl"
                aria-label="Fixkostenfenster schlie√üen">&times;</button>
            <h3 id="fixkosten-modal-title" class="text-2xl font-bold mb-4 tracking-tight text-white">Fixkosten &amp;
                Sparpl√§ne</h3>
            <p class="text-sm text-gray-400 -mt-3 mb-6">Verwalte deine wiederkehrenden Ausgaben und teile sie Konten
                oder Sparpl√§nen zu.</p>

            <div class="bg-gray-800/50 p-4 md:p-6 rounded-xl border border-gray-700/50 mb-6">
                <!-- Headers -->
                <div
                    class="hidden md:grid grid-cols-12 gap-3 mb-3 px-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">
                    <div class="col-span-4">Bezeichnung</div>
                    <div class="col-span-3">Betrag</div>
                    <div class="col-span-2">Intervall</div>
                    <div class="col-span-2">Ziel</div>
                    <div class="col-span-1 text-center">Aktion</div>
                </div>

                <div id="fixkosten-list" class="space-y-3 max-h-[50vh] overflow-y-auto pr-2 custom-scrollbar"></div>

                <button type="button" onclick="addFixkostenItem()"
                    class="mt-5 w-full border-2 border-dashed border-gray-600 hover:border-[#033D5D] text-gray-400 hover:text-white hover:bg-[#033D5D]/20 py-3 rounded-xl transition-all flex items-center justify-center gap-2 group">
                    <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Neuen Posten hinzuf√ºgen
                </button>
            </div>

            <div
                class="bg-gray-800/50 p-4 md:p-6 rounded-xl border border-gray-700/50 flex justify-between items-center">
                <div>
                    <p class="text-sm font-medium text-gray-400">Monatliche Gesamtkosten</p>
                    <p id="modal-total" class="text-3xl font-bold text-red-400 tracking-tight mt-1">0 ‚Ç¨</p>
                </div>
                <div class="hidden md:block">
                    <svg class="w-10 h-10 text-gray-600 opacity-50" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
                        </path>
                    </svg>
                </div>
            </div>

            <button type="button" onclick="saveFixkosten()"
                class="mt-8 w-full bg-[#033D5D] hover:bg-[#022a40] text-white font-bold py-4 px-6 rounded-xl shadow-[0_8px_16px_-6px_rgba(3,61,93,0.5)] transition-all flex items-center justify-center gap-2 text-lg active:scale-[0.98]">
                <svg class="w-5 h-5 text-white/90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Speichern &amp; Schlie√üen
            </button>
        </div>

        <div id="depot-modal"
            class="modal fixed inset-0 bg-black bg-opacity-75 items-start justify-center p-4 z-50 overflow-y-auto"
            role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="depot-modal-title"
            aria-describedby="depot-modal-description">
            <div class="bg-secondary w-full max-w-2xl rounded-xl shadow-2xl p-6 relative my-8 md:my-16 flex-shrink-0 mx-auto"
                role="document" tabindex="-1" style="margin-top: 5vh; margin-bottom: 5vh;">
                <button type="button" onclick="closeModal('depot-modal')"
                    class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl"
                    aria-label="Depotfenster schlie√üen">&times;</button>
                <h3 id="depot-modal-title" class="text-2xl font-bold mb-1 tracking-tight text-white">Depot-Aufteilung
                </h3>
                <p id="depot-modal-description" class="text-sm text-gray-400 mb-6">Wie sollen neue Investments in der
                    Zukunft verteilt werden?</p>

                <!-- Wissens-Datenbank: 4 Dezente Info-Quadrate (Flex Row enforced + SVG Icons) -->
                <div class="flex gap-2 mb-8 w-full">
                    <!-- Cost Average -->
                    <button type="button" onclick="openCostAverageModal()"
                        class="flex-1 flex flex-col items-center justify-start p-2 sm:p-3 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/5 transition-all group shadow-sm hover:shadow-md"
                        title="Warum welcher Fonds? (Cost-Average-Effekt)">
                        <div
                            class="w-8 h-8 sm:w-10 sm:h-10 mb-1.5 sm:mb-2 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400 group-hover:scale-110 transition-transform">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                </path>
                            </svg>
                        </div>
                        <p
                            class="text-[9px] sm:text-[10px] font-semibold text-gray-400 group-hover:text-white transition-colors text-center leading-tight uppercase tracking-wide">
                            Cost<br>Average</p>
                    </button>

                    <!-- SoRR -->
                    <button type="button" onclick="openSoRRModal()"
                        class="flex-1 flex flex-col items-center justify-start p-2 sm:p-3 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/5 transition-all group shadow-sm hover:shadow-md"
                        title="Entnahmephase: Reihenfolge-Risiko">
                        <div
                            class="w-8 h-8 sm:w-10 sm:h-10 mb-1.5 sm:mb-2 rounded-xl bg-rose-500/20 flex items-center justify-center text-rose-400 group-hover:scale-110 transition-transform">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                                </path>
                            </svg>
                        </div>
                        <p
                            class="text-[9px] sm:text-[10px] font-semibold text-gray-400 group-hover:text-white transition-colors text-center leading-tight uppercase tracking-wide">
                            SoRR<br>Risiko</p>
                    </button>

                    <!-- Aktien vs Anleihen -->
                    <button type="button" onclick="openAnleihenModal()"
                        class="flex-1 flex flex-col items-center justify-start p-2 sm:p-3 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/5 transition-all group shadow-sm hover:shadow-md"
                        title="Aktien vs. Anleihen">
                        <div
                            class="w-8 h-8 sm:w-10 sm:h-10 mb-1.5 sm:mb-2 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400 group-hover:scale-110 transition-transform">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                            </svg>
                        </div>
                        <p
                            class="text-[9px] sm:text-[10px] font-semibold text-gray-400 group-hover:text-white transition-colors text-center leading-tight uppercase tracking-wide">
                            Aktien<br>Anleihe</p>
                    </button>

                    <!-- MSCI Grafik -->
                    <button type="button" onclick="openMsciRenditedreieck()"
                        class="flex-1 flex flex-col items-center justify-start p-2 sm:p-3 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/5 transition-all group shadow-sm hover:shadow-md"
                        title="Originales MSCI Renditedreieck">
                        <div
                            class="w-8 h-8 sm:w-10 sm:h-10 mb-1.5 sm:mb-2 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400 group-hover:scale-110 transition-transform">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z">
                                </path>
                            </svg>
                        </div>
                        <p
                            class="text-[9px] sm:text-[10px] font-semibold text-gray-400 group-hover:text-white transition-colors text-center leading-tight uppercase tracking-wide">
                            MSCI<br>Grafik</p>
                    </button>
                </div>

                <!-- List of Fonds -->
                <div id="depot-list" class="space-y-3 max-h-64 overflow-y-auto pr-2 mb-2 custom-scrollbar"></div>

                <button type="button" onclick="addDepotItem()"
                    class="mt-2 text-sm flex items-center gap-2 text-gray-400 hover:text-white transition-colors py-2 px-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Weiteren Fonds hinzuf√ºgen
                </button>

                <div class="flex justify-between items-end mt-6 mb-2">
                    <p class="text-[11px] text-gray-400 font-semibold tracking-wider uppercase">Gesamtverteilung</p>
                    <p id="depot-total" class="text-3xl font-light tracking-tight text-white font-mono">100<span
                            class="text-xl text-gray-500">%</span></p>
                </div>
                <div class="h-1.5 w-full bg-black/40 rounded-full mb-1 overflow-hidden shadow-inner">
                    <div id="depot-total-bar" class="h-full bg-mlp-blue transition-all duration-300 w-full"
                        style="width: 100%;"></div>
                </div>
                <p id="depot-warning" class="text-xs text-yellow-400 h-4 mb-8 text-right font-medium"></p>

                <!-- Prognose Section -->
                <div class="bg-black/20 rounded-2xl p-6 border border-white/5 mb-8">
                    <h4 class="text-xs font-bold text-gray-300 uppercase tracking-widest mb-6 flex items-center gap-3">
                        <svg class="w-4 h-4 text-mlp-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Prognose Parameter
                    </h4>

                    <div class="space-y-5">
                        <!-- Aktueller Depotstand -->
                        <div>
                            <label for="depotCurrent"
                                class="text-[11px] text-gray-400 font-semibold block mb-2 uppercase tracking-wide">Startkapital
                                / Aktueller Wert</label>
                            <div
                                class="flex items-center gap-2 bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus-within:border-mlp-blue focus-within:bg-white/10 transition-all">
                                <span class="text-gray-400 font-medium">‚Ç¨</span>
                                <input type="number" id="depotCurrent" value="25000"
                                    class="flex-1 bg-transparent text-white outline-none font-mono text-lg"
                                    inputmode="decimal" placeholder="0">
                            </div>
                        </div>

                        <div class="flex flex-col gap-5">
                            <!-- Anlagehorizont -->
                            <div>
                                <label for="anlagezeitraum"
                                    class="text-[11px] text-gray-400 font-semibold block mb-2 uppercase tracking-wide">Anlagehorizont</label>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs text-gray-500 font-medium">Laufzeit</span>
                                    <span id="anlagezeitraum-label"
                                        class="text-sm font-bold text-mlp-blue bg-mlp-blue/10 px-2 py-0.5 rounded-md">15
                                        Jahre</span>
                                </div>
                                <input type="range" id="anlagezeitraum" min="1" max="30" value="15"
                                    class="mlp-range mt-2 w-full block">
                            </div>

                            <!-- Erwartete Rendite -->
                            <div>
                                <label for="rendite"
                                    class="text-[11px] text-gray-400 font-semibold block mb-2 uppercase tracking-wide">Erwartete
                                    Rendite</label>
                                <div
                                    class="flex items-center gap-2 bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus-within:border-mlp-blue focus-within:bg-white/10 transition-all">
                                    <input type="number" id="rendite" step="0.1" value="7"
                                        class="flex-1 bg-transparent text-white outline-none font-mono text-lg text-left"
                                        inputmode="decimal" placeholder="0">
                                    <span class="text-gray-400 font-medium">% pa.</span>
                                </div>
                            </div>
                        </div>
                        <div id="rendite-info" class="text-[11px] text-gray-500 mt-3 px-1"></div>
                    </div>
                </div>

                <!-- Haupt-Aktionen (Premium Footer) -->
                <div class="flex flex-col sm:flex-row gap-4 mt-8">
                    <button id="depot-save-button" type="button" onclick="saveDepot()"
                        class="flex-1 bg-white/5 border border-white/10 hover:bg-white/10 hover:border-white/20 text-white font-semibold py-4 px-6 rounded-2xl flex items-center justify-center gap-2 transition-all active:scale-95">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        Speichern & Schlie√üen
                    </button>

                    <button type="button" onclick="showProjection();"
                        class="flex-1 bg-gradient-to-br from-mlp-blue to-blue-700 hover:from-blue-500 hover:to-blue-600 border border-blue-400/30 text-white font-bold py-4 px-6 rounded-2xl flex items-center justify-center gap-2 transition-all active:scale-95 shadow-[0_10px_20px_-10px_rgba(30,136,229,0.5)]">
                        <svg class="w-5 h-5 text-white/90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z">
                            </path>
                        </svg>
                        Kursprognose erstellen
                    </button>
                </div>


            </div>
        </div>

        <!-- MSCI Renditedreieck Modal -->
        <div id="msci-modal" class="modal fixed inset-0 bg-black bg-opacity-90 items-center justify-center p-4 z-50"
            role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="msci-modal-title">
            <div class="w-full h-full max-w-7xl max-h-screen relative flex flex-col" role="document" tabindex="-1">
                <div class="flex justify-between items-center mb-3">
                    <h3 id="msci-modal-title" class="text-2xl font-bold text-white">MSCI World Renditedreieck</h3>
                    <button type="button" onclick="closeMsciRenditedreieck()"
                        class="text-gray-400 hover:text-white text-3xl"
                        aria-label="MSCI Renditedreieck schlie√üen">&times;</button>
                </div>

                <div class="flex-1 bg-white rounded-lg overflow-hidden relative cursor-zoom-in" id="msci-container"
                    onclick="toggleMsciZoom(event)">
                    <img id="msci-image" src="assets/msci_renditedreieck.png" alt="MSCI World Renditedreieck"
                        class="w-full h-full object-contain transition-transform duration-300">
                </div>
                <p class="text-sm text-gray-400 text-center mt-3">Klicke auf das Bild zum Zoomen</p>
            </div>
        </div>

        <!-- v1.6.2: Cost-Average-Effekt Erkl√§rer Modal -->
        <div id="cost-average-modal"
            class="modal fixed inset-0 bg-black bg-opacity-90 items-center justify-center p-8 z-[60]" role="dialog"
            aria-modal="true" aria-hidden="true" aria-labelledby="cost-average-title">
            <div class="bg-white w-full max-w-5xl rounded-xl shadow-2xl p-8 relative" role="document" tabindex="-1"
                style="max-height: 90vh; overflow-y: auto;">
                <button type="button" onclick="closeCostAverageModal()"
                    class="absolute top-6 right-6 text-gray-600 hover:text-gray-900 text-3xl"
                    aria-label="Cost-Average Erkl√§rer schlie√üen">&times;</button>

                <!-- Phase 1: Vergleichsansicht -->
                <div id="ca-phase-1">
                    <h2 id="cost-average-title" class="text-3xl font-bold mb-4"
                        style="color: var(--mlp-corporate-blue);">
                        Warum volatile Kurse bei Sparraten BESSER sind</h2>
                    <p class="text-lg text-gray-700 mb-4">Vergleich zweier Kursverl√§ufe - Einzahlung: 1.200 ‚Ç¨ pro Jahr!
                    </p>

                    <!-- v1.7.1: Edit-Mode Controls -->
                    <div class="flex gap-2 mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <button id="edit-mode-toggle-btn" onclick="toggleEditMode()"
                            class="px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                            style="background: var(--mlp-corporate-blue); color: white;">
                            üìù Bearbeitungsmodus
                        </button>
                        <button id="save-course-btn" onclick="saveCourseData()"
                            class="px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                            style="background: #10b981; color: white; display: none;">
                            üíæ Speichern & Neuberechnen
                        </button>
                        <button onclick="resetToDefaultCourse()"
                            class="px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                            style="background: #6b7280; color: white;">
                            üîÑ Zur√ºcksetzen
                        </button>
                        <span id="edit-mode-hint" class="ml-auto text-sm text-gray-500 self-center italic"
                            style="display: none;">
                            üí° Ziehe die Datenpunkte mit der Maus nach oben/unten
                        </span>
                    </div>

                    <!-- Side-by-Side Comparison -->
                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <!-- Kurs A: Stabil -->
                        <div id="ca-box-a" class="p-6 rounded-lg cursor-pointer transition-all hover:shadow-xl"
                            style="background: rgba(3, 61, 93, 0.05); border: 2px solid var(--mlp-corporate-blue);">
                            <h3 class="text-xl font-bold mb-4" style="color: var(--mlp-corporate-blue);">üìà Kurs A:
                                Stabil
                                steigend</h3>

                            <!-- Chart A -->
                            <div class="bg-white p-4 rounded-lg mb-4" style="border: 1px solid var(--mlp-titanium);">
                                <canvas id="ca-chart-a" style="max-height: 250px;"></canvas>
                            </div>

                            <!-- Share Bars Container A -->
                            <div id="ca-share-bars-a" class="space-y-2 mb-4" style="min-height: 200px;">
                                <!-- Will be populated dynamically during animation -->
                            </div>

                            <!-- Counters A -->
                            <div class="space-y-3 p-4 bg-white rounded-lg"
                                style="border: 1px solid var(--mlp-titanium);">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Jahr:</span>
                                    <span id="ca-month-a" class="text-lg font-bold"
                                        style="color: var(--mlp-corporate-blue);">0 / 10</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Investiert:</span>
                                    <span id="ca-invested-a" class="text-lg font-bold"
                                        style="color: var(--mlp-corporate-blue);">0 ‚Ç¨</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Anteile gesamt:</span>
                                    <span id="ca-shares-a" class="text-lg font-bold"
                                        style="color: var(--mlp-corporate-blue);">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Kurs B: Volatil -->
                        <div id="ca-box-b" class="p-6 rounded-lg cursor-pointer transition-all hover:shadow-xl"
                            style="background: rgba(193, 41, 61, 0.05); border: 2px solid #C1293D;">
                            <h3 class="text-xl font-bold mb-4" style="color: #C1293D;">üìâüìà Kurs B: Volatil mit CRASH
                            </h3>

                            <!-- Chart B -->
                            <div class="bg-white p-4 rounded-lg mb-4" style="border: 1px solid var(--mlp-titanium);">
                                <canvas id="ca-chart-b" style="max-height: 250px;"></canvas>
                            </div>

                            <!-- Share Bars Container B -->
                            <div id="ca-share-bars-b" class="space-y-2 mb-4" style="min-height: 200px;">
                                <!-- Will be populated dynamically during animation -->
                            </div>

                            <!-- Counters B -->
                            <div class="space-y-3 p-4 bg-white rounded-lg"
                                style="border: 1px solid var(--mlp-titanium);">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Jahr:</span>
                                    <span id="ca-month-b" class="text-lg font-bold" style="color: #C1293D;">0 /
                                        10</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Investiert:</span>
                                    <span id="ca-invested-b" class="text-lg font-bold" style="color: #C1293D;">0
                                        ‚Ç¨</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600">Anteile gesamt:</span>
                                    <span id="ca-shares-b" class="text-lg font-bold" style="color: #C1293D;">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Instruction Text (replaces button) -->
                    <div class="text-center text-gray-600 mb-4">
                        <p class="text-lg">üëÜ <strong>Klicken Sie auf einen der beiden Kurse</strong>, um die Animation
                            zu
                            starten</p>
                    </div>
                </div>

                <!-- Phase 2: Ergebnis (initially hidden, click anywhere to close) -->
                <div id="ca-phase-3" class="cursor-pointer" style="display: none;" onclick="closeCostAverageModal()">
                    <h2 class="text-3xl font-bold mb-6" style="color: var(--mlp-corporate-blue);">‚ö° √úberraschendes
                        Ergebnis!
                    </h2>

                    <div class="grid grid-cols-2 gap-8 mb-8">
                        <!-- Kurs A Ergebnis -->
                        <div class="p-8 rounded-lg"
                            style="background: rgba(3, 61, 93, 0.1); border: 2px solid var(--mlp-corporate-blue);">
                            <h3 class="text-2xl font-bold mb-4" style="color: var(--mlp-corporate-blue);">Kurs A
                                (stabil)
                            </h3>
                            <div class="space-y-3">
                                <p class="text-gray-700"><span class="font-semibold">Investiert:</span> 12.000 ‚Ç¨</p>
                                <p class="text-gray-700"><span class="font-semibold">Anteile:</span> <span
                                        id="ca-result-shares-a">7.856,90</span></p>
                                <p class="text-gray-700"><span class="font-semibold">Kurs im Jahr 10:</span> <span
                                        id="ca-result-endprice-a">18,90 ‚Ç¨</span></p>
                                <p class="text-gray-700"><span class="font-semibold">Endwert:</span> <span
                                        id="ca-result-value-a">148.495,35 ‚Ç¨</span></p>
                                <hr style="border-color: var(--mlp-titanium);">
                                <p class="text-2xl font-bold" style="color: var(--color-success);">Gewinn: <span
                                        id="ca-result-profit-a">28.495,35 ‚Ç¨</span></p>
                                <p class="text-lg text-gray-600">Rendite: <span id="ca-result-return-a">3,8%</span></p>
                            </div>
                        </div>

                        <!-- Kurs B Ergebnis -->
                        <div class="p-8 rounded-lg"
                            style="background: rgba(193, 41, 61, 0.1); border: 2px solid #C1293D;">
                            <h3 class="text-2xl font-bold mb-4" style="color: #C1293D;">Kurs B (volatil) ‚úÖ</h3>
                            <div class="space-y-3">
                                <p class="text-gray-700"><span class="font-semibold">Investiert:</span> 12.000 ‚Ç¨</p>
                                <p class="text-gray-700"><span class="font-semibold">Anteile:</span> <span
                                        id="ca-result-shares-b">23.733,33</span></p>
                                <p class="text-gray-700"><span class="font-semibold">Kurs im Jahr 10:</span> <span
                                        id="ca-result-endprice-b">10,50 ‚Ç¨</span></p>
                                <p class="text-gray-700"><span class="font-semibold">Endwert:</span> <span
                                        id="ca-result-value-b">249.200,00 ‚Ç¨</span></p>
                                <hr style="border-color: var(--mlp-titanium);">
                                <p class="text-2xl font-bold" style="color: var(--color-success);">Gewinn: <span
                                        id="ca-result-profit-b">129.200,00 ‚Ç¨</span></p>
                                <p class="text-lg text-gray-600">Rendite: <span id="ca-result-return-b">13,0%</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Crash Insight Box -->
                    <div class="p-8 rounded-lg mb-6"
                        style="background: linear-gradient(135deg, #C1293D 0%, #E3691E 100%); color: white;">
                        <h3 class="text-2xl font-bold mb-4">üí• Der Crash-Vorteil:</h3>
                        <p class="text-xl leading-relaxed mb-4">Haben Sie gesehen? <strong>Jahr 2: Crash auf 2,00
                                ‚Ç¨</strong>
                            - und das war <strong>die beste Kaufgelegenheit</strong>!</p>
                        <div class="bg-white bg-opacity-20 p-4 rounded-lg mb-4">
                            <p class="text-lg">üõí <strong>600 Anteile</strong> f√ºr 1.200 ‚Ç¨ beim Crash (Jahr 2)</p>
                            <p class="text-lg">üõí Nur <strong>92 Anteile</strong> f√ºr 1.200 ‚Ç¨ bei Kurs A</p>
                        </div>
                        <p class="text-xl leading-relaxed"><strong>Bei Sparraten WOLLEN Sie Crashes</strong> - Sie
                            kaufen
                            dann im Ausverkauf! üéâ</p>
                    </div>

                    <!-- General Insight Box -->
                    <div class="p-8 rounded-lg mb-8"
                        style="background: linear-gradient(135deg, #033D5D 0%, #47A190 100%); color: white;">
                        <h3 class="text-2xl font-bold mb-4">üí° Die Strategie:</h3>
                        <div class="space-y-4">
                            <div>
                                <p class="text-lg font-bold mb-2">üìà Einmalanlagen (z.B. 50.000 ‚Ç¨ Erbe):</p>
                                <p class="text-lg opacity-90">‚Üí Stabile Fonds (blau) w√§hlen</p>
                                <p class="text-base opacity-75">Grund: Crash w√ºrde sofort viel Geld vernichten</p>
                            </div>
                            <div>
                                <p class="text-lg font-bold mb-2">üí∞ Sparraten (z.B. monatlich 1.200 ‚Ç¨):</p>
                                <p class="text-lg opacity-90">‚Üí Volatile Fonds (rot) w√§hlen</p>
                                <p class="text-base opacity-75">Grund: Crashes sind Chancen - Sie kaufen g√ºnstig nach!
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Instruction to close -->
                    <div class="text-center text-gray-600 py-4">
                        <p class="text-lg">üëÜ <strong>Klicken Sie irgendwo, um zur√ºckzukehren</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- v1.6.3: Kriegskasse Erkl√§rer Modal -->
        <div id="kriegskasse-modal"
            class="modal fixed inset-0 bg-black bg-opacity-90 items-center justify-center p-8 z-[60]" role="dialog"
            aria-modal="true" aria-hidden="true" aria-labelledby="kriegskasse-title">
            <div class="bg-white w-full max-w-7xl rounded-xl shadow-2xl p-8 relative" role="document" tabindex="-1"
                style="max-height: 90vh; overflow-y: auto;">
                <button type="button" onclick="closeKriegskasseModal()"
                    class="absolute top-6 right-6 text-gray-600 hover:text-gray-900 text-3xl"
                    aria-label="Kriegskasse Erkl√§rer schlie√üen">&times;</button>

                <!-- Phase 1: Intro -->
                <div id="kriegskasse-phase-1">
                    <h2 id="kriegskasse-title" class="text-3xl font-bold mb-6"
                        style="color: var(--mlp-corporate-blue);">üí∞
                        Die Kriegskasse: Schutz UND Chance!</h2>
                    <p class="text-lg text-gray-700 mb-8">Drei Szenarien im Crash: Panikverkauf vs. Durchhalten vs.
                        Aktiv
                        Nachkaufen</p>

                    <!-- Combined Chart with Toggle -->
                    <div class="bg-white p-6 rounded-lg mb-6" style="border: 2px solid var(--mlp-titanium);">
                        <!-- Toggle Switch -->
                        <div class="flex justify-end mb-4">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <span class="text-sm font-semibold text-gray-700">Tagesgeld-Zufluss (6.000‚Ç¨/Jahr)</span>
                                <div class="relative">
                                    <input type="checkbox" id="kriegskasse-inflow-toggle" class="sr-only peer" checked>
                                    <div
                                        class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-mlp-blue">
                                    </div>
                                </div>
                            </label>
                        </div>
                        <div style="position: relative; height: 400px; width: 100%;">
                            <canvas id="kriegskasse-chart-combined"></canvas>
                        </div>
                    </div>

                    <!-- 3-Column Timelines & Controls -->
                    <div class="grid grid-cols-3 gap-6 mb-8">
                        <!-- Scenario A: WITHOUT Tagesgeld -->
                        <div id="kriegskasse-box-a" class="p-6 rounded-lg cursor-pointer transition-all hover:shadow-xl"
                            style="background: rgba(193, 41, 61, 0.05); border: 2px solid #C1293D;">
                            <h3 class="text-xl font-bold mb-4" style="color: #C1293D;">‚ùå Ohne Reserve</h3>

                            <!-- Timeline A -->
                            <div class="space-y-2 mb-4" id="kriegskasse-timeline-a" style="min-height: 140px;">
                                <div class="text-sm text-gray-500">Klick zum Start...</div>
                            </div>

                            <!-- Counter -->
                            <div class="flex justify-between text-sm text-gray-600">
                                <span>Jahr:</span>
                                <span id="kriegskasse-year-a">0 / 10</span>
                            </div>
                        </div>

                        <!-- Scenario B: WITH Tagesgeld (Hold) -->
                        <div id="kriegskasse-box-b" class="p-6 rounded-lg cursor-pointer transition-all hover:shadow-xl"
                            style="background: rgba(3, 61, 93, 0.05); border: 2px solid var(--mlp-corporate-blue);">
                            <h3 class="text-xl font-bold mb-4" style="color: var(--mlp-corporate-blue);">‚úÖ Mit Reserve
                                (Halten)</h3>

                            <!-- Timeline B -->
                            <div class="space-y-2 mb-4" id="kriegskasse-timeline-b" style="min-height: 140px;">
                                <div class="text-sm text-gray-500">Klick zum Start...</div>
                            </div>

                            <!-- Counter -->
                            <div class="flex justify-between text-sm text-gray-600">
                                <span>Jahr:</span>
                                <span id="kriegskasse-year-b">0 / 10</span>
                            </div>
                        </div>

                        <!-- Scenario C: WITH Tagesgeld (Active Buy) -->
                        <div id="kriegskasse-box-c" class="p-6 rounded-lg cursor-pointer transition-all hover:shadow-xl"
                            style="background: rgba(166, 168, 171, 0.05); border: 2px solid var(--mlp-titanium);">
                            <h3 class="text-xl font-bold mb-4" style="color: var(--mlp-titanium);">üöÄ Mit Reserve +
                                Nachkauf
                            </h3>

                            <!-- Timeline C -->
                            <div class="space-y-2 mb-4" id="kriegskasse-timeline-c" style="min-height: 140px;">
                                <div class="text-sm text-gray-500">Klick zum Start...</div>
                            </div>

                            <!-- Counter -->
                            <div class="flex justify-between text-sm text-gray-600">
                                <span>Jahr:</span>
                                <span id="kriegskasse-year-c">0 / 10</span>
                            </div>
                        </div>
                    </div>

                    <div class="text-center text-gray-600 mb-4">
                        <p class="text-lg">üëÜ <strong>Klicken Sie auf ein Szenario</strong>, um die Animation zu starten
                        </p>
                    </div>
                </div>

                <!-- Phase 2: Ergebnis -->
                <div id="kriegskasse-phase-2" class="cursor-pointer" style="display: none;"
                    onclick="closeKriegskasseModal()">
                    <h2 class="text-3xl font-bold mb-6" style="color: var(--mlp-corporate-blue);">‚ö° Der
                        Kriegskasse-Effekt!
                    </h2>

                    <div class="grid grid-cols-3 gap-6 mb-8">
                        <!-- Scenario A Result -->
                        <div class="p-6 rounded-lg"
                            style="background: rgba(193, 41, 61, 0.1); border: 2px solid #C1293D;">
                            <h3 class="text-xl font-bold mb-3" style="color: #C1293D;">Ohne Reserve ‚ùå</h3>
                            <div class="space-y-2 text-sm">
                                <p class="text-gray-700"><span class="font-semibold">Start:</span> 10.000 ‚Ç¨</p>
                                <p class="text-gray-700"><span class="font-semibold">Verkauft (J2):</span> <span
                                        id="kriegskasse-result-sold-a">2.000 ‚Ç¨</span></p>
                                <p class="text-gray-700"><span class="font-semibold">Re-Entry (J5):</span> <span
                                        id="kriegskasse-result-reentry-a">10,5 ‚Ç¨</span></p>
                                <hr style="border-color: var(--mlp-titanium);">
                                <p class="text-xl font-bold" style="color: #C1293D;">Endwert: <span
                                        id="kriegskasse-result-value-a">8.400 ‚Ç¨</span></p>
                                <p class="text-base text-gray-600"><span id="kriegskasse-result-loss-a">-1.600 ‚Ç¨</span>
                                </p>
                            </div>
                        </div>

                        <!-- Scenario B Result -->
                        <div class="p-6 rounded-lg"
                            style="background: rgba(3, 61, 93, 0.1); border: 2px solid var(--mlp-corporate-blue);">
                            <h3 class="text-xl font-bold mb-3" style="color: var(--mlp-corporate-blue);">Mit Reserve
                                (Halten) ‚úÖ</h3>
                            <div class="space-y-2 text-sm">
                                <p class="text-gray-700"><span class="font-semibold">Start:</span> 10.000 ‚Ç¨</p>
                                <p class="text-gray-700"><span class="font-semibold">Crash:</span> Durchgehalten! üõ°Ô∏è
                                </p>
                                <p class="text-gray-700"><span class="font-semibold">Tagesgeld:</span> F√ºr Leben genutzt
                                </p>
                                <hr style="border-color: var(--mlp-titanium);">
                                <p class="text-xl font-bold" style="color: var(--color-success);">Endwert: <span
                                        id="kriegskasse-result-value-b">10.500 ‚Ç¨</span></p>
                                <p class="text-base text-gray-600"><span id="kriegskasse-result-profit-b">+500 ‚Ç¨</span>
                                </p>
                            </div>
                        </div>

                        <!-- Scenario C Result -->
                        <div class="p-6 rounded-lg"
                            style="background: rgba(166, 168, 171, 0.1); border: 2px solid var(--mlp-titanium);">
                            <h3 class="text-xl font-bold mb-3" style="color: var(--mlp-titanium);">Mit Reserve +
                                Nachkauf üöÄ
                            </h3>
                            <div class="space-y-2 text-sm">
                                <p class="text-gray-700"><span class="font-semibold">Start:</span> 10.000 ‚Ç¨</p>
                                <p class="text-gray-700"><span class="font-semibold">Nachkauf (J2):</span> <span
                                        id="kriegskasse-result-buy-c">12.000 ‚Ç¨</span></p>
                                <p class="text-gray-700"><span class="font-semibold">TG wieder voll:</span> Jahr 4</p>
                                <hr style="border-color: var(--mlp-titanium);">
                                <p class="text-xl font-bold" style="color: var(--color-success);">Endwert: <span
                                        id="kriegskasse-result-value-c">17.325 ‚Ç¨</span></p>
                                <p class="text-base text-gray-600"><span id="kriegskasse-result-profit-c">+7.325
                                        ‚Ç¨</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Insight Box -->
                    <div class="p-8 rounded-lg mb-8"
                        style="background: linear-gradient(135deg, #E3691E 0%, #C1293D 100%); color: white;">
                        <h3 class="text-2xl font-bold mb-4">üöÄ Die Kriegskasse macht's m√∂glich:</h3>
                        <div class="space-y-4">
                            <div>
                                <p class="text-lg font-bold mb-2">‚ùå Ohne Reserve:</p>
                                <p class="text-base opacity-90">‚Üí Panikverkauf im Crash (-80%)</p>
                                <p class="text-base opacity-90">‚Üí Zu sp√§ter Wiedereinstieg</p>
                                <p class="text-base opacity-75 mt-2"><strong>Ergebnis: -1.600 ‚Ç¨ Verlust</strong></p>
                            </div>
                            <div>
                                <p class="text-lg font-bold mb-2">‚úÖ Mit Reserve (Halten):</p>
                                <p class="text-base opacity-90">‚Üí Durchhalten dank Tagesgeld</p>
                                <p class="text-base opacity-90">‚Üí Volle Erholung mitgenommen</p>
                                <p class="text-base opacity-75 mt-2"><strong>Ergebnis: +500 ‚Ç¨ Gewinn</strong></p>
                            </div>
                            <div>
                                <p class="text-lg font-bold mb-2">üöÄ Mit Reserve + Nachkauf:</p>
                                <p class="text-base opacity-90">‚Üí 12.000 ‚Ç¨ aus Tagesgeld im Crash nachgekauft (Preis: 2
                                    ‚Ç¨)
                                </p>
                                <p class="text-base opacity-90">‚Üí 2 Jahre keine Sparrate (Tagesgeld wieder auff√ºllen)
                                </p>
                                <p class="text-base opacity-90">‚Üí Massiv mehr Anteile zu Billigpreisen</p>
                                <p class="text-base opacity-75 mt-2"><strong>Ergebnis: +7.325 ‚Ç¨ Gewinn - <span
                                            id="kriegskasse-difference-c">6.825 ‚Ç¨ mehr</span> als Halten!</strong></p>
                            </div>
                        </div>
                    </div>

                    <!-- Instruction to close -->
                    <div class="text-center text-gray-600 py-4">
                        <p class="text-base">üëÜ <strong>Klicken Sie irgendwo, um zur√ºckzukehren</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- v1.7.2: Sequence of Returns Risk (SoRR) Simulator Modal -->
        <div id="sorr-modal" class="modal fixed inset-0 bg-black bg-opacity-90 items-center justify-center p-8 z-[60]"
            role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="sorr-title">
            <div class="bg-white text-gray-900 w-full max-w-7xl rounded-xl shadow-2xl p-8 relative overflow-y-auto"
                role="document" tabindex="-1" style="max-height: 95vh;">
                <button type="button" onclick="closeSoRRModal()"
                    class="absolute top-6 right-6 text-gray-600 hover:text-gray-900 text-3xl z-10"
                    aria-label="SoRR Simulator schlie√üen">&times;</button>

                <h2 id="sorr-title" class="text-3xl font-bold mb-2 text-gray-900"
                    style="color: var(--mlp-corporate-blue);">
                    ‚ö†Ô∏è Sequence of Returns Risk
                </h2>
                <p class="text-lg text-gray-900 mb-6">
                    Warum die Reihenfolge der Renditen in der Entnahmephase entscheidend ist.
                    <span class="text-sm text-gray-600 block mt-1">Datenbasis: MSCI World (2005‚Äì2024)</span>
                </p>

                <div class="flex flex-col md:flex-row gap-6">

                    <!-- LEFT COLUMN: Parameter & Table -->
                    <div class="w-full md:w-1/3 flex flex-col gap-6 h-[80vh]">
                        <!-- Parameter Box -->
                        <div class="bg-gray-50/80 p-5 rounded-xl border border-gray-200 shrink-0">
                            <h3 class="text-sm font-semibold text-gray-400 mb-4 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                                    </path>
                                </svg>
                                Parameter
                            </h3>
                            <div class="flex flex-col gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Startkapital</label>
                                    <div class="relative w-64 max-w-full">
                                        <input type="number" id="sorr-initial-capital" value="500000"
                                            oninput="updateSoRRWithdrawalRate()"
                                            class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-mlp-blue focus:outline-none text-gray-900 font-mono text-lg">
                                        <span class="absolute right-3 top-2.5 text-gray-400">‚Ç¨</span>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">J√§hrliche Entnahme
                                        (Start)</label>
                                    <div class="relative w-64 max-w-full">
                                        <input type="number" id="sorr-annual-withdrawal" value="20000"
                                            oninput="updateSoRRWithdrawalRate()"
                                            class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-mlp-blue focus:outline-none text-gray-900 font-mono text-lg">
                                        <span class="absolute right-3 top-2.5 text-gray-400">‚Ç¨</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1"><span id="sorr-withdrawal-rate">4.0</span>%
                                        Entnahmerate</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Dynamik der
                                        Entnahme</label>
                                    <div class="relative w-64 max-w-full">
                                        <input type="number" id="sorr-inflation" value="2.0" step="0.1"
                                            class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-mlp-blue focus:outline-none text-gray-900 font-mono text-lg">
                                        <span class="absolute right-3 top-2.5 text-gray-400">% p.a.</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Inflationsanpassung der Entnahmen</p>
                                </div>

                                <button onclick="runSoRRSimulation()"
                                    class="w-fit bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-colors mt-2 shadow-sm flex items-center justify-center gap-2 whitespace-nowrap">
                                    üîÑ Neu berechnen
                                </button>
                            </div>
                        </div>

                        <!-- Data Table Box -->
                        <div
                            class="flex flex-col bg-gray-50/80 rounded-xl border border-gray-200 overflow-hidden flex-grow min-h-0">
                            <div class="flex justify-between items-center p-4 border-b border-gray-200 bg-white">
                                <h3 class="text-base font-bold text-gray-800">MSCI World Renditen</h3>
                                <span id="sorr-avg-return"
                                    class="text-xs bg-blue-100 text-blue-800 py-1.5 px-2.5 rounded-full font-bold tracking-wide">√ò
                                    9.58% p.a.</span>
                            </div>
                            <div class="overflow-y-auto flex-grow custom-scrollbar">
                                <table class="min-w-full text-xs text-gray-900">
                                    <thead class="bg-gray-100 sticky top-0 shadow-sm">
                                        <tr>
                                            <th class="px-4 py-2.5 text-left font-semibold text-gray-600">Jahr</th>
                                            <th class="px-4 py-2.5 text-right font-semibold text-gray-600">Rendite</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sorr-returns-table" class="divide-y divide-gray-100">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN: Chart, Cards & Lesson -->
                    <div class="w-full md:w-2/3 flex flex-col gap-6 h-[80vh]">

                        <!-- Chart Box -->
                        <div
                            class="bg-white p-5 rounded-xl border border-gray-200 flex-grow relative flex flex-col min-h-0">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h3 id="sorr-chart-title" class="text-lg font-bold text-gray-800">
                                        Verm√∂gensentwicklung
                                    </h3>
                                    <p id="sorr-chart-subtitle" class="text-sm text-gray-500">Reihenfolge wie sie
                                        tats√§chlich war: 2005, 2006, 2007...</p>
                                </div>
                                <button id="sorr-compare-btn" onclick="toggleSoRRCompare()"
                                    class="text-xs font-semibold py-2 px-4 rounded-lg border transition-all duration-200 border-gray-300 text-gray-600 hover:border-gray-400 hover:text-gray-800 hover:bg-gray-50">
                                    Alle Szenarien vergleichen
                                </button>
                            </div>
                            <div class="flex-grow w-full h-full relative">
                                <canvas id="sorr-chart"></canvas>
                            </div>
                        </div>

                        <!-- 3 Result Cards (Clickable Scenarios) -->
                        <div id="sorr-result-cards" class="grid grid-cols-1 md:grid-cols-3 gap-4 shrink-0">
                            <button onclick="setSoRRScenario('history')" id="sorr-card-history"
                                class="text-left px-4 py-3 rounded-xl border-2 transition-all duration-200 flex flex-col justify-center border-green-500 bg-green-50/50 hover:bg-green-50">
                                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider">Historisch
                                    (2005-2024)
                                </h4>
                                <div class="flex items-baseline gap-2 mt-1">
                                    <span id="sorr-result-history" class="text-2xl font-black text-green-700">500k
                                        ‚Ç¨</span>
                                    <span id="sorr-duration-history"
                                        class="text-sm text-gray-600 font-semibold">Endlos</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-2 leading-snug h-8">Startet schwach (2008 Crash),
                                    endet
                                    stark.</p>
                            </button>

                            <button onclick="setSoRRScenario('reverse')" id="sorr-card-reverse"
                                class="text-left px-4 py-3 rounded-xl border border-gray-200 bg-white hover:bg-gray-50 transition-all duration-200 flex flex-col justify-center">
                                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider">Best-First (Fiktiv)
                                </h4>
                                <div class="flex items-baseline gap-2 mt-1">
                                    <span id="sorr-result-reverse" class="text-2xl font-black text-gray-800">500k
                                        ‚Ç¨</span>
                                    <span id="sorr-duration-reverse"
                                        class="text-sm text-gray-600 font-semibold">Endlos</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-2 leading-snug h-8">Beste Jahre zuerst. Crash erst
                                    ganz
                                    am Ende.</p>
                            </button>

                            <button onclick="setSoRRScenario('worst')" id="sorr-card-worst"
                                class="text-left px-4 py-3 rounded-xl border border-gray-200 bg-white hover:bg-gray-50 transition-all duration-200 flex flex-col justify-center">
                                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider">Worst-First
                                    (Fiktiv)
                                </h4>
                                <div class="flex items-baseline gap-2 mt-1">
                                    <span id="sorr-result-worst" class="text-2xl font-black text-gray-800">500k ‚Ç¨</span>
                                    <span id="sorr-duration-worst"
                                        class="text-sm text-gray-600 font-semibold">Endlos</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-2 leading-snug h-8">Schlechteste Jahre (-40%) direkt
                                    zum
                                    Start.</p>
                            </button>
                        </div>

                        <!-- Lesson Box -->
                        <div
                            class="bg-yellow-50/80 border border-yellow-200 p-4 rounded-xl shrink-0 flex items-start gap-4 shadow-sm">
                            <span class="text-2xl mt-0.5">üí°</span>
                            <p class="text-sm text-yellow-900 leading-relaxed">
                                <strong class="font-bold text-yellow-900/90 text-sm">Was lernt der Kunde?</strong> Die
                                durchschnittliche Rendite von 9% sch√ºtzt nicht vor Pleite, wenn der Crash im 1.
                                Rentenjahr
                                passiert ("Worst-First"). <br>
                                <span class="bg-yellow-200/50 px-1 py-0.5 rounded font-semibold">L√∂sung: 2-3 Jahre
                                    Entnahmen
                                    als Tagesgeld-Reserve</span> ‚Üê Erm√∂glicht es, in Krisen auszusitzen, ohne verkaufen
                                zu
                                m√ºssen.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- v1.7.8: Slider-Styling f√ºr Anleihen-Modal -->

        <!-- v1.7.8: Aktien & Anleihen Erkl√§rer Modal -->
        <div id="anleihen-modal"
            class="modal fixed inset-0 bg-black bg-opacity-90 items-center justify-center p-8 z-[60]" role="dialog"
            aria-modal="true" aria-hidden="true" aria-labelledby="anleihen-title">
            <div class="bg-white w-full max-w-7xl rounded-xl shadow-2xl p-8 relative overflow-y-auto" role="document"
                tabindex="-1" style="max-height: 95vh;">
                <button type="button" onclick="closeAnleihenModal()"
                    class="absolute top-6 right-6 text-gray-600 hover:text-gray-900 text-3xl z-10"
                    aria-label="Aktien & Anleihen Modal schlie√üen">&times;</button>

                <h2 id="anleihen-title" class="text-3xl font-bold mb-2" style="color: var(--mlp-corporate-blue);">
                    üìä Aktien & Anleihen
                </h2>
                <p class="text-lg mb-6" style="color: #2B2B2B;">
                    Warum Aktien langfristig mehr Rendite bringen m√ºssen als Anleihen.
                </p>

                <!-- Tab-Navigation -->
                <div class="flex gap-2 mb-6">
                    <button id="anleihen-tab-btn-duration" onclick="switchAnleihenTab('duration')"
                        class="px-4 py-2 rounded-lg font-semibold text-sm transition-all"
                        style="background: #033D5D; color: white;">
                        Zinssensitivit√§t
                    </button>
                    <button id="anleihen-tab-btn-seesaw" onclick="switchAnleihenTab('seesaw')"
                        class="px-4 py-2 rounded-lg font-semibold text-sm transition-all"
                        style="background: #F8F8F8; color: #2B2B2B; border: 1px solid #BEB6AA;">
                        Inverse Beziehung
                    </button>
                    <button id="anleihen-tab-btn-spread" onclick="switchAnleihenTab('spread')"
                        class="px-4 py-2 rounded-lg font-semibold text-sm transition-all"
                        style="background: #F8F8F8; color: #2B2B2B; border: 1px solid #BEB6AA;">
                        Equity Premium
                    </button>
                </div>

                <!-- Tab 1: Zinssensitivit√§t (Duration) -->
                <div id="anleihen-tab-duration">
                    <div class="grid grid-cols-12 gap-6">
                        <!-- Left: Inputs (4 cols) -->
                        <div class="col-span-4 space-y-4">
                            <div class="p-4 rounded-lg" style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: #033D5D;">
                                    Anleihe-Parameter</h3>

                                <div class="mb-3">
                                    <label class="block text-sm font-medium mb-1" style="color: #2B2B2B;">Kupon
                                        (Zinssatz)</label>
                                    <div class="relative">
                                        <input type="number" id="anleihen-kupon" value="3.0" step="0.5" min="0" max="15"
                                            class="w-full p-2 rounded-md focus:outline-none"
                                            style="border: 1px solid #BEB6AA; color: #2B2B2B;"
                                            onchange="updateDurationChart()">
                                        <span class="absolute right-3 top-2" style="color: #717171;">% p.a.</span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="block text-sm font-medium mb-1"
                                        style="color: #2B2B2B;">Restlaufzeit</label>
                                    <div class="relative">
                                        <input type="number" id="anleihen-laufzeit" value="10" step="1" min="1" max="30"
                                            class="w-full p-2 rounded-md focus:outline-none"
                                            style="border: 1px solid #BEB6AA; color: #2B2B2B;"
                                            onchange="updateDurationChart()">
                                        <span class="absolute right-3 top-2" style="color: #717171;">Jahre</span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="block text-sm font-medium mb-1"
                                        style="color: #2B2B2B;">Nennwert</label>
                                    <div class="relative">
                                        <input type="number" id="anleihen-nennwert" value="10000" step="1000" min="1000"
                                            class="w-full p-2 rounded-md focus:outline-none"
                                            style="border: 1px solid #BEB6AA; color: #2B2B2B;"
                                            onchange="updateDurationChart()">
                                        <span class="absolute right-3 top-2" style="color: #717171;">‚Ç¨</span>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 rounded-lg" style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: #033D5D;">
                                    Zins√§nderung</h3>
                                <label class="block text-sm font-medium mb-1" style="color: #2B2B2B;">
                                    Marktzins √§ndert sich um: <span id="anleihen-zinsdelta-display" class="font-bold"
                                        style="color: #033D5D;">+1.0%</span>
                                </label>
                                <input type="range" id="anleihen-zinsdelta" min="-3" max="3" step="0.5" value="1.0"
                                    class="w-full" style="accent-color: #033D5D;"
                                    oninput="var v=parseFloat(this.value); document.getElementById('anleihen-zinsdelta-display').textContent = (v>=0?'+':'')+v.toFixed(1)+'%'; updateDurationChart();">
                                <div class="flex justify-between text-xs mt-1" style="color: #717171;">
                                    <span>-3.0%</span>
                                    <span>0</span>
                                    <span>+3.0%</span>
                                </div>
                            </div>

                            <!-- Ergebnis-Card -->
                            <div id="anleihen-duration-result" class="p-4 rounded-lg"
                                style="background: rgba(3,61,93,0.06); border: 1px solid rgba(3,61,93,0.2);">
                                <div class="text-sm font-semibold mb-1" style="color: #033D5D;">Aktueller Kurs</div>
                                <div id="anleihen-kurs-wert" class="text-2xl font-bold" style="color: #033D5D;">10.000 ‚Ç¨
                                </div>
                                <div id="anleihen-kurs-prozent" class="text-sm" style="color: #47A190;">100,00% vom
                                    Nennwert
                                </div>
                            </div>
                        </div>

                        <!-- Right: Chart (8 cols) -->
                        <div class="col-span-8">
                            <div class="bg-white rounded-lg p-4"
                                style="height: 420px; border: 1px solid #BEB6AA; box-shadow: 0 1px 3px rgba(0,0,0,0.12);">
                                <canvas id="anleihen-duration-chart"></canvas>
                            </div>
                            <p class="text-xs mt-2 text-center" style="color: #717171;">
                                Kurs√§nderung der Anleihe bei Zins√§nderung ‚Äî je k√ºrzer die Restlaufzeit, desto geringer
                                die
                                Schwankung (Pull-to-Par)
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Inverse Beziehung (F√ºllstands-Visualisierung) -->
                <div id="anleihen-tab-seesaw" style="display: none;">
                    <div class="grid grid-cols-12 gap-6">
                        <!-- Left: Controls (4 cols) -->
                        <div class="col-span-4 space-y-4">
                            <div class="p-4 rounded-lg" style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: #033D5D;">
                                    Marktzins</h3>
                                <label class="block text-sm font-medium mb-1" style="color: #2B2B2B;">
                                    Aktueller Marktzins: <span id="anleihen-marktzins-display" class="font-bold"
                                        style="color: #033D5D;">3.0%</span>
                                </label>
                                <input type="range" id="anleihen-marktzins" min="0" max="5" step="0.25" value="3.0"
                                    class="w-full" style="accent-color: #033D5D;"
                                    oninput="document.getElementById('anleihen-marktzins-display').textContent = this.value + '%'; updateSeesawVis();">
                                <div class="flex justify-between text-xs mt-1" style="color: #717171;">
                                    <span>0%</span>
                                    <span>5%</span>
                                </div>
                            </div>

                            <div class="p-4 rounded-lg" style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: #033D5D;">
                                    Anleihe-Daten</h3>
                                <p class="text-sm mb-1" style="color: #2B2B2B;">Kupon: <span id="seesaw-kupon"
                                        class="font-semibold">3.0%</span></p>
                                <p class="text-sm mb-1" style="color: #2B2B2B;">Laufzeit: <span id="seesaw-laufzeit"
                                        class="font-semibold">10 Jahre</span></p>
                                <p class="text-xs mt-2" style="color: #717171;">(√úbernommen aus Tab 1)</p>
                            </div>

                            <!-- Kurs-Anzeige -->
                            <div id="seesaw-result" class="p-4 rounded-lg"
                                style="background: rgba(3,61,93,0.06); border: 1px solid rgba(3,61,93,0.2);">
                                <div class="text-sm font-semibold mb-1" style="color: #033D5D;">Anleihekurs</div>
                                <div id="seesaw-kurs-wert" class="text-2xl font-bold" style="color: #033D5D;">100,00%
                                </div>
                                <div id="seesaw-kurs-euro" class="text-sm" style="color: #47A190;">10.000 ‚Ç¨</div>
                            </div>
                        </div>

                        <!-- Right: F√ºllstands-Visualisierung (8 cols) -->
                        <div class="col-span-8">
                            <div class="p-8 rounded-lg"
                                style="background: #FFFFFF; border: 1px solid #BEB6AA; box-shadow: 0 1px 3px rgba(0,0,0,0.12);">

                                <!-- Zwei Tanks nebeneinander -->
                                <div class="flex items-end justify-center gap-16">

                                    <!-- Tank Links: Marktzins -->
                                    <div class="flex flex-col items-center">
                                        <div class="text-sm font-semibold mb-2 uppercase tracking-wide"
                                            style="color: #BEB6AA;">Marktzins</div>
                                        <div class="relative"
                                            style="width: 120px; height: 280px; border: 2px solid #BEB6AA; border-radius: 8px; background: #F8F8F8; overflow: hidden;">
                                            <!-- F√ºllstand -->
                                            <div id="seesaw-tank-zins"
                                                style="position: absolute; bottom: 0; left: 0; right: 0; height: 60%; background: linear-gradient(to top, #BEB6AA, #d4cfc7); border-radius: 0 0 6px 6px; transition: height 0.5s ease-out;">
                                            </div>
                                            <!-- Wert-Label -->
                                            <div id="seesaw-tank-zins-label"
                                                class="absolute inset-0 flex items-center justify-center text-xl font-bold"
                                                style="color: #033D5D; text-shadow: 0 1px 2px rgba(255,255,255,0.8);">
                                                3.0%
                                            </div>
                                        </div>
                                        <!-- Skala-Markierungen -->
                                        <div class="flex justify-between w-full mt-1 text-xs" style="color: #717171;">
                                            <span>0%</span>
                                            <span>5%</span>
                                        </div>
                                    </div>

                                    <!-- Verbindungs-Indikator -->
                                    <div class="flex flex-col items-center gap-2 self-center">
                                        <svg width="80" height="48" viewBox="0 0 80 48">
                                            <!-- Pfeil links nach rechts oben -->
                                            <path d="M 8,36 C 30,36 50,12 72,12" fill="none" stroke="#47A190"
                                                stroke-width="2.5" stroke-dasharray="5 3">
                                                <animate attributeName="stroke-dashoffset" values="0;-16" dur="1s"
                                                    repeatCount="indefinite" />
                                            </path>
                                            <polygon points="72,12 62,8 64,16" fill="#47A190" />
                                            <!-- Pfeil rechts nach links unten -->
                                            <path d="M 72,36 C 50,36 30,12 8,12" fill="none" stroke="#47A190"
                                                stroke-width="2.5" stroke-dasharray="5 3">
                                                <animate attributeName="stroke-dashoffset" values="0;-16" dur="1s"
                                                    repeatCount="indefinite" />
                                            </path>
                                            <polygon points="8,12 18,8 16,16" fill="#47A190" />
                                        </svg>
                                        <div class="text-xs font-semibold text-center" style="color: #47A190;">
                                            invers<br>gekoppelt</div>
                                    </div>

                                    <!-- Tank Rechts: Anleihekurs -->
                                    <div class="flex flex-col items-center">
                                        <div class="text-sm font-semibold mb-2 uppercase tracking-wide"
                                            style="color: #033D5D;">Anleihekurs</div>
                                        <div class="relative"
                                            style="width: 120px; height: 280px; border: 2px solid #033D5D; border-radius: 8px; background: #F8F8F8; overflow: hidden;">
                                            <!-- F√ºllstand -->
                                            <div id="seesaw-tank-kurs"
                                                style="position: absolute; bottom: 0; left: 0; right: 0; height: 50%; background: linear-gradient(to top, #033D5D, #0a5a8a); border-radius: 0 0 6px 6px; transition: height 0.5s ease-out;">
                                            </div>
                                            <!-- Wert-Label -->
                                            <div id="seesaw-tank-kurs-label"
                                                class="absolute inset-0 flex items-center justify-center text-xl font-bold"
                                                style="color: #033D5D; text-shadow: 0 1px 2px rgba(255,255,255,0.8);">
                                                100%
                                            </div>
                                            <!-- Par-Linie (100% = 50% in 80-120 range) -->
                                            <div id="seesaw-par-dash"
                                                style="position: absolute; bottom: 50%; left: -4px; right: -4px; height: 0; border-top: 2px dashed #BEB6AA;">
                                            </div>
                                            <div id="seesaw-par-line"
                                                style="position: absolute; bottom: 50%; right: -36px; font-size: 10px; color: #717171; font-weight: 600;">
                                                100%</div>
                                        </div>
                                        <!-- Skala -->
                                        <div class="flex justify-between w-full mt-1 text-xs" style="color: #717171;">
                                            <span>80%</span>
                                            <span>120%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Dynamischer Erkl√§rtext -->
                                <div id="seesaw-explain" class="mt-6 p-4 rounded-lg text-center"
                                    style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                    <p class="text-sm" style="color: #2B2B2B;" id="seesaw-explain-text">
                                        Bei gleichem Marktzins wie Kupon steht die Anleihe <strong>genau bei
                                            Par</strong>
                                        (100%). Bewegen Sie den Regler, um die inverse Beziehung zu erleben.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Equity Risk Premium -->
                <div id="anleihen-tab-spread" style="display: none;">

                    <!-- Interaktive Kapitalfluss-Erkl√§rung -->
                    <div class="grid grid-cols-12 gap-6">
                        <!-- Left: Slider + Ergebnis (4 cols) -->
                        <div class="col-span-4 space-y-4">
                            <div class="p-4 rounded-lg" style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: #033D5D;">
                                    Unternehmens-Rendite</h3>
                                <label class="block text-sm font-medium mb-1" style="color: #2B2B2B;">
                                    Das Unternehmen erwirtschaftet: <span id="equity-rendite-display" class="font-bold"
                                        style="color: #033D5D;">8%</span>
                                </label>
                                <input type="range" id="equity-rendite-slider" min="0" max="15" step="0.5" value="8"
                                    class="w-full" style="accent-color: #033D5D;" oninput="updateEquityFlow();">
                                <div class="flex justify-between text-xs mt-1" style="color: #717171;">
                                    <span>0%</span>
                                    <span>15%</span>
                                </div>
                            </div>

                            <div class="p-4 rounded-lg" style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: #033D5D;">
                                    Anleihe-Kosten</h3>
                                <label class="block text-sm font-medium mb-1" style="color: #2B2B2B;">
                                    Zinsen an Anleihegl√§ubiger: <span id="equity-zins-display" class="font-bold"
                                        style="color: #BEB6AA;">3%</span>
                                </label>
                                <input type="range" id="equity-zins-slider" min="0" max="10" step="0.5" value="3"
                                    class="w-full" style="accent-color: #BEB6AA;" oninput="updateEquityFlow();">
                                <div class="flex justify-between text-xs mt-1" style="color: #717171;">
                                    <span>0%</span>
                                    <span>10%</span>
                                </div>
                            </div>

                            <!-- Ergebnis -->
                            <div id="equity-result-card" class="p-4 rounded-lg"
                                style="background: rgba(71,161,144,0.08); border: 1px solid rgba(71,161,144,0.3);">
                                <div class="text-sm font-semibold mb-1" id="equity-result-label"
                                    style="color: #47A190;">
                                    Gewinn der Aktion√§re</div>
                                <div id="equity-result-value" class="text-2xl font-bold" style="color: #033D5D;">+5,0%
                                </div>
                                <div id="equity-result-text" class="text-sm" style="color: #47A190;">Equity Risk Premium
                                </div>
                            </div>

                            <!-- Fazit-Box -->
                            <div id="equity-fazit" class="p-3 rounded-lg"
                                style="background: #F8F8F8; border: 1px solid #BEB6AA;">
                                <p class="text-xs" style="color: #2B2B2B;" id="equity-fazit-text">
                                    <strong>Ergebnis:</strong> Das Unternehmen verdient 5% mehr als es f√ºr das geliehene
                                    Geld zahlt. Dieser √úberschuss steigert den Unternehmenswert und geh√∂rt den
                                    Aktion√§ren.
                                </p>
                            </div>
                        </div>

                        <!-- Right: Visualisierung (8 cols) -->
                        <div class="col-span-8 flex items-center justify-center">
                            <svg id="equity-flow-svg" viewBox="0 0 560 400" class="w-full" style="max-width: 560px;">
                                <!-- Unternehmen (Zentrum) -->
                                <rect x="190" y="130" width="180" height="80" rx="12" fill="#033D5D" stroke="#022a40"
                                    stroke-width="2" />
                                <text x="280" y="162" text-anchor="middle" fill="white" font-size="13"
                                    font-weight="bold">Unternehmen</text>
                                <text x="280" y="182" text-anchor="middle" fill="#8ec5e0" font-size="12"
                                    id="equity-company-text">erwirtschaftet 8%</text>

                                <!-- Anleihegl√§ubiger (Links) ‚Äî Titanium -->
                                <rect x="10" y="10" width="150" height="60" rx="10" fill="#BEB6AA" stroke="#a89e90"
                                    stroke-width="2" />
                                <text x="85" y="35" text-anchor="middle" fill="#2B2B2B" font-size="12"
                                    font-weight="bold">Anleihegl√§ubiger</text>
                                <text x="85" y="52" text-anchor="middle" fill="#5a5349"
                                    font-size="11">(Fremdkapital)</text>

                                <!-- Pfeil-Marker -->
                                <defs>
                                    <marker id="arrow-titanium" markerWidth="10" markerHeight="7" refX="9" refY="3.5"
                                        orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#BEB6AA" />
                                    </marker>
                                    <marker id="arrow-mlp" markerWidth="10" markerHeight="7" refX="9" refY="3.5"
                                        orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#033D5D" />
                                    </marker>
                                    <marker id="arrow-tuerkis" markerWidth="10" markerHeight="7" refX="9" refY="3.5"
                                        orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#47A190" />
                                    </marker>
                                    <marker id="arrow-warn" markerWidth="10" markerHeight="7" refX="9" refY="3.5"
                                        orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#C1293D" />
                                    </marker>
                                </defs>

                                <!-- Pfeil: Gl√§ubiger verleihen Geld ‚Üí Unternehmen -->
                                <path d="M 135,70 C 135,100 210,100 210,130" fill="none" stroke="#033D5D"
                                    stroke-width="2.5" stroke-dasharray="6 3" marker-end="url(#arrow-mlp)" />
                                <text x="145" y="100" fill="#033D5D" font-size="10" font-weight="600">verleiht
                                    Geld</text>

                                <!-- Pfeil: Unternehmen zahlt Zinsen ‚Üí Gl√§ubiger -->
                                <path d="M 190,150 C 140,150 85,110 85,70" fill="none" stroke="#BEB6AA" stroke-width="3"
                                    marker-end="url(#arrow-titanium)">
                                    <animate attributeName="stroke-dasharray" values="0 200;200 0" dur="2s"
                                        repeatCount="indefinite" />
                                </path>
                                <rect x="75" y="102" width="70" height="22" rx="4" fill="white" stroke="#BEB6AA"
                                    stroke-width="1" />
                                <text x="110" y="117" text-anchor="middle" fill="#8a8179" font-size="12"
                                    font-weight="bold" id="equity-zins-flow">3% Zinsen</text>
                                <text x="110" y="90" text-anchor="middle" fill="#8a8179" font-size="9">‚ÄûMiete" f√ºr
                                    Geld</text>

                                <!-- Aktion√§re (Rechts) ‚Äî T√ºrkis -->
                                <rect x="400" y="10" width="150" height="60" rx="10" fill="#47A190" stroke="#3a8474"
                                    stroke-width="2" id="equity-aktionaer-box" />
                                <text x="475" y="35" text-anchor="middle" fill="white" font-size="12"
                                    font-weight="bold">Aktion√§re</text>
                                <text x="475" y="52" text-anchor="middle" fill="#c5e8e0"
                                    font-size="11">(Eigenkapital)</text>

                                <!-- Pfeil: Unternehmen ‚Üí Aktion√§re (Gewinn) -->
                                <path d="M 350,150 C 400,150 475,110 475,70" fill="none" stroke="#47A190"
                                    stroke-width="3" id="equity-profit-arrow" marker-end="url(#arrow-tuerkis)">
                                    <animate attributeName="stroke-dasharray" values="0 200;200 0" dur="2s"
                                        repeatCount="indefinite" />
                                </path>
                                <rect x="385" y="102" width="85" height="22" rx="4" fill="white" stroke="#47A190"
                                    stroke-width="1" id="equity-profit-bg" />
                                <text x="428" y="117" text-anchor="middle" fill="#3a8474" font-size="12"
                                    font-weight="bold" id="equity-profit-flow">+5% Gewinn</text>
                                <text x="428" y="90" text-anchor="middle" fill="#3a8474" font-size="9"
                                    id="equity-profit-label">Wertsteigerung</text>

                                <!-- Balken-Vergleich unten -->
                                <text x="280" y="250" text-anchor="middle" fill="#2B2B2B" font-size="12"
                                    font-weight="bold">Aufteilung der Unternehmensrendite</text>

                                <!-- Balken: Gesamt-Rendite -->
                                <rect x="80" y="268" width="400" height="30" rx="6" fill="#F8F8F8" stroke="#BEB6AA"
                                    stroke-width="1" />

                                <!-- Balken: Zinskosten (Titanium) -->
                                <rect x="80" y="268" rx="6" height="30" fill="#BEB6AA" id="equity-bar-zins"
                                    width="150" />
                                <text y="288" fill="white" font-size="11" font-weight="bold" id="equity-bar-zins-text"
                                    x="155" text-anchor="middle">3%</text>

                                <!-- Balken: Gewinn (T√ºrkis) -->
                                <rect y="268" height="30" fill="#47A190" id="equity-bar-gewinn" x="230" width="250"
                                    rx="0" />
                                <text y="288" fill="white" font-size="11" font-weight="bold" id="equity-bar-gewinn-text"
                                    x="355" text-anchor="middle">5%</text>

                                <!-- Labels unter Balken -->
                                <text x="155" y="315" text-anchor="middle" fill="#8a8179" font-size="10"
                                    id="equity-bar-label-zins">Zinsen (Anleihe)</text>
                                <text x="355" y="315" text-anchor="middle" fill="#3a8474" font-size="10"
                                    id="equity-bar-label-gewinn">Aktion√§rsgewinn</text>

                                <!-- Warnung bei Verlust -->
                                <g id="equity-warning" style="display: none;">
                                    <rect x="130" y="335" width="300" height="36" rx="8" fill="#fef2f2" stroke="#C1293D"
                                        stroke-width="1.5" />
                                    <text x="280" y="350" text-anchor="middle" fill="#C1293D" font-size="11"
                                        font-weight="bold" id="equity-warning-text">Unternehmen kann Zinsen nicht
                                        bedienen!</text>
                                    <text x="280" y="365" text-anchor="middle" fill="#C1293D"
                                        font-size="10">Insolvenzgefahr</text>
                                </g>
                            </svg>
                        </div>
                    </div>

                    <!-- Drei Erkl√§rs√§ulen -->
                    <div class="mt-6 grid grid-cols-3 gap-4">
                        <div class="p-4 rounded-lg"
                            style="background: rgba(190,182,170,0.12); border: 1px solid #BEB6AA;">
                            <p class="font-semibold mb-1 text-sm" style="color: #033D5D;">1. Anleihe = ‚ÄûMiete" f√ºr Geld
                            </p>
                            <p class="text-xs" style="color: #2B2B2B;">Das Unternehmen gibt eine Anleihe heraus und
                                verspricht, regelm√§√üig Zinsen zu zahlen. Wie ein Mieter, der Miete f√ºr eine Wohnung
                                zahlt ‚Äî
                                nur hier ist es Miete f√ºr geliehenes Kapital.</p>
                        </div>
                        <div class="p-4 rounded-lg"
                            style="background: rgba(71,161,144,0.06); border: 1px solid rgba(71,161,144,0.3);">
                            <p class="font-semibold mb-1 text-sm" style="color: #033D5D;">2. Gewinne > Miete = Wachstum
                            </p>
                            <p class="text-xs" style="color: #2B2B2B;">Das Unternehmen investiert das Geld in Projekte
                                und
                                Produkte. Die Gewinne daraus m√ºssen h√∂her sein als die Zinszahlungen ‚Äî sonst lohnt sich
                                das
                                Gesch√§ft nicht. Der √úberschuss steigert den Unternehmenswert.</p>
                        </div>
                        <div class="p-4 rounded-lg"
                            style="background: rgba(3,61,93,0.04); border: 1px solid rgba(3,61,93,0.15);">
                            <p class="font-semibold mb-1 text-sm" style="color: #033D5D;">3. Aktion√§re profitieren vom
                                Rest
                            </p>
                            <p class="text-xs" style="color: #2B2B2B;">Erst werden die Anleihegl√§ubiger bezahlt
                                (Priorit√§t!). Was √ºbrig bleibt, geh√∂rt den Aktion√§ren. Daf√ºr tragen sie das volle Risiko
                                ‚Äî
                                und verlangen deshalb langfristig eine h√∂here Rendite als Anleihen bieten.</p>
                        </div>
                    </div>
                </div>

                <!-- Lesson Box (immer sichtbar) -->
                <div class="mt-6 p-4 rounded-lg"
                    style="background: rgba(3,61,93,0.04); border-left: 4px solid #BEB6AA;">
                    <p class="text-sm" style="color: #2B2B2B;">
                        <strong style="color: #033D5D;">Merke:</strong> Eine Anleihe ist nur dann ‚Äûsicher", wenn der
                        Emittent zahlungsf√§hig bleibt
                        und man die Laufzeit aussitzt. Die Schwankungen dazwischen sind lediglich Opportunit√§tskosten
                        des
                        Marktes.
                    </p>
                </div>
            </div>
        </div>

        <!-- Immobilien Modal -->
        <div id="immobilien-modal"
            class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-50" role="dialog"
            aria-modal="true" aria-hidden="true" aria-labelledby="immobilien-modal-title"
            aria-describedby="immobilien-modal-description">
            <div class="bg-secondary w-full max-w-3xl rounded-xl shadow-2xl p-6 relative" role="document" tabindex="-1">
                <button type="button" onclick="closeModal('immobilien-modal')"
                    class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl"
                    aria-label="Immobilienfenster schlie√üen">&times;</button>
                <h3 id="immobilien-modal-title" class="text-xl font-bold mb-4">Immobilien-Verwaltung</h3>
                <p id="immobilien-modal-description" class="text-sm text-gray-400 -mt-3 mb-4">Verwalte deine Immobilien,
                    Einnahmen und Ausgaben.</p>

                <!-- Anzahl Immobilien -->
                <div class="mb-4 bg-primary p-4 rounded-lg flex items-center gap-4">
                    <label class="text-sm text-gray-400 whitespace-nowrap">Anzahl Immobilien</label>
                    <input type="number" id="immo-anzahl" value="1" min="0" max="99"
                        class="w-20 bg-tertiary p-2 rounded-lg text-white text-center" inputmode="numeric">
                </div>

                <!-- Grid f√ºr 2 Kategorien -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Verm√∂gen (Immobilienwert) -->
                    <div class="bg-primary p-4 rounded-lg">
                        <h4 class="text-lg font-bold mb-3 text-green-400">Verm√∂gen</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Immobilienwert</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="immo-wert" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="Wert der Immobilie">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Wertsteigerung (optional)</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="immo-wertsteigerung" value="0" step="0.1"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="z.B. 2.0">
                                    <span class="text-gray-400">% p.a.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Verbindlichkeiten -->
                    <div class="bg-primary p-4 rounded-lg">
                        <h4 class="text-lg font-bold mb-3 text-red-400">Verbindlichkeiten</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Restdarlehen (aktuell)</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="immo-darlehen" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="Aktuelle Restschuld">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Urspr√ºngliches Darlehen</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="immo-darlehen-original" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="Darlehensbetrag bei Aufnahme">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">F√ºr korrekte Ratenberechnung (Annuit√§t bleibt
                                    konstant)</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Zinssatz (optional)</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="immo-zinssatz" value="0" step="0.1"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="z.B. 3.5">
                                    <span class="text-gray-400">%</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Tilgungssatz (optional)</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="immo-tilgungssatz" value="0" step="0.1"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="z.B. 2.0">
                                    <span class="text-gray-400">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Zusammenfassung -->
                <div class="mt-6 bg-primary p-4 rounded-lg">
                    <div class="text-center">
                        <p class="text-sm text-gray-400 mb-2">Nettoverm√∂gen (Wert - Darlehen)</p>
                        <p id="immo-nettovermoegen" class="text-3xl font-bold text-green-400">0 ‚Ç¨</p>
                    </div>
                </div>

                <!-- Berechnete Darlehensrate anzeigen -->
                <div id="immo-rate-berechnet-display"
                    class="mt-6 p-4 bg-blue-900 bg-opacity-30 rounded-lg border border-mlp-blue hidden">
                    <h4 class="text-sm font-semibold text-blue-300 mb-2">üìä Berechnete monatliche Darlehensrate</h4>
                    <p class="text-2xl font-bold text-white"><span id="immo-rate-berechnet-wert">0 ‚Ç¨</span></p>
                    <p class="text-xs text-gray-400 mt-1">
                        Zinsen: <span id="immo-rate-zinsen">0 ‚Ç¨</span> | Tilgung: <span id="immo-rate-tilgung">0
                            ‚Ç¨</span>
                    </p>
                    <p class="text-xs text-blue-300 mt-2">üí° Diese Rate wird automatisch ins Vermieterkonto √ºbertragen.
                    </p>
                </div>

                <!-- Tilgungsplan Slider -->
                <div id="immo-tilgungsplan-section" class="mt-6 bg-primary p-4 rounded-lg hidden">
                    <h4 class="text-lg font-bold mb-3 text-mlp-blue">üìà Tilgungsplan & Verm√∂gensaufbau</h4>

                    <div class="mb-4">
                        <label class="text-sm text-gray-400 block mb-2">
                            Zeitraum: <span id="immo-tilgungsplan-jahre" class="font-bold text-white">10</span> Jahre
                        </label>
                        <input type="range" id="immo-tilgungsplan-slider" min="0" max="20" value="10" step="1"
                            class="w-full">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>0 Jahre</span>
                            <span>20 Jahre</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                        <div class="text-center">
                            <p class="text-xs text-gray-400">Restschuld</p>
                            <p id="immo-tilgungsplan-restschuld" class="text-lg font-bold text-red-400">0 ‚Ç¨</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-400">Gezahlte Zinsen</p>
                            <p id="immo-tilgungsplan-zinsen" class="text-lg font-bold text-yellow-400">0 ‚Ç¨</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-400">Eigenkapital</p>
                            <p id="immo-tilgungsplan-eigenkapital" class="text-lg font-bold text-green-400">0 ‚Ç¨</p>
                        </div>
                    </div>

                    <div class="mt-4 text-center">
                        <p class="text-xs text-gray-400">Immobilienwert (mit Wertsteigerung)</p>
                        <p id="immo-tilgungsplan-wert" class="text-xl font-bold text-mlp-blue">0 ‚Ç¨</p>
                    </div>
                </div>

                <div class="mt-4 p-3 bg-blue-900 bg-opacity-30 rounded-lg border border-mlp-blue">
                    <p class="text-sm text-blue-300">üí° <strong>Tipp:</strong> Einnahmen und Ausgaben werden im
                        <strong>Vermieterkonto</strong> verwaltet.
                    </p>
                </div>

                <button type="button" onclick="saveImmobilien()"
                    class="mt-6 w-full bg-[#033D5D] hover:bg-[#022A40] text-white font-bold py-3 px-6 rounded-xl shadow-[0_8px_16px_-6px_rgba(3,61,93,0.5)] transition-all flex items-center justify-center gap-2 active:scale-[0.98]">
                    <svg class="w-5 h-5 text-white/90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Speichern &amp; Schlie√üen
                </button>
            </div>
        </div>

        <!-- Vermieterkonto Modal -->
        <div id="vermieterkonto-modal"
            class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-50" role="dialog"
            aria-modal="true" aria-hidden="true" aria-labelledby="vermieterkonto-modal-title">
            <div class="bg-secondary w-full max-w-2xl rounded-xl shadow-2xl p-6 relative" role="document" tabindex="-1">
                <button type="button" onclick="closeModal('vermieterkonto-modal')"
                    class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl"
                    aria-label="Vermieterkonto schlie√üen">&times;</button>
                <h3 id="vermieterkonto-modal-title" class="text-xl font-bold mb-4">Vermieterkonto</h3>
                <p class="text-sm text-gray-400 -mt-3 mb-4">Alle Einnahmen und Ausgaben deiner Immobilien laufen √ºber
                    dieses
                    kostenlose Konto.</p>

                <!-- Grid f√ºr 2 Kategorien -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Monatliche Einnahmen -->
                    <div class="bg-primary p-4 rounded-lg">
                        <h4 class="text-lg font-bold mb-3 text-green-400">Monatliche Einnahmen</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Mieteinnahmen</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="vk-miete" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="Monatliche Miete">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Sonstige Einnahmen</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="vk-sonstige-einnahmen" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="z.B. Stellplatz, Garage">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monatliche Ausgaben -->
                    <div class="bg-primary p-4 rounded-lg">
                        <h4 class="text-lg font-bold mb-3 text-red-400">Monatliche Ausgaben</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Darlehensrate</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="vk-rate" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="Monatliche Rate">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Instandhaltung</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="vk-instandhaltung" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="R√ºcklagen">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 block mb-1">Steuern & Nebenkosten</label>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="vk-steuern" value="0"
                                        class="flex-1 bg-tertiary p-2 rounded-lg text-white" inputmode="decimal"
                                        placeholder="Grundsteuer, Versicherung">
                                    <span class="text-gray-400">‚Ç¨</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Zusammenfassung -->
                <div class="mt-6 bg-primary p-4 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <p class="text-sm text-gray-400">Einnahmen</p>
                            <p id="vk-einnahmen-total" class="text-xl font-bold text-green-400">0 ‚Ç¨</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Ausgaben</p>
                            <p id="vk-ausgaben-total" class="text-xl font-bold text-red-400">0 ‚Ç¨</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Monatlicher Saldo</p>
                            <p id="vk-saldo" class="text-2xl font-bold text-mlp-blue">0 ‚Ç¨</p>
                        </div>
                    </div>
                </div>

                <button type="button" onclick="saveVermieterkonto()"
                    class="mt-8 w-full bg-[#033D5D] hover:bg-[#022A40] text-white font-bold py-4 px-6 rounded-xl shadow-[0_8px_16px_-6px_rgba(3,61,93,0.5)] transition-all flex items-center justify-center gap-2 text-lg active:scale-[0.98]">
                    <svg class="w-5 h-5 text-white/90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Speichern &amp; Schlie√üen
                </button>
            </div>
        </div>

        <script type="module" src="/src/main.js"></script>

        <!-- ===== SESSION UI ELEMENTS (v1.2.0) ===== -->

        <!-- Elegant Session Button (Top Left) -->
        <div id="session-button-container" style="display: none;" class="fixed top-4 left-4 z-50">
            <button onclick="toggleSessionMenu()" id="session-menu-button"
                class="group bg-secondary bg-opacity-80 backdrop-blur-sm hover:bg-opacity-95 text-gray-300 hover:text-white px-3 py-2 rounded-lg shadow-lg transition-all duration-200 flex items-center gap-2 border border-gray-700 hover:border-gray-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <span class="text-xs font-medium">Session</span>
                <svg id="session-menu-chevron" class="w-3 h-3 transition-transform duration-200" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>

            <!-- Dropdown Menu -->
            <div id="session-dropdown" style="display: none;"
                class="absolute top-full left-0 mt-2 w-72 bg-secondary bg-opacity-95 backdrop-blur-md rounded-lg shadow-2xl border border-gray-700 overflow-hidden">
                <div class="p-4 border-b border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xs font-semibold text-gray-400 uppercase tracking-wide">Session-ID</span>
                        <span id="session-id-display"
                            class="text-xs font-mono text-white bg-primary px-2 py-1 rounded">-</span>
                    </div>
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xs font-semibold text-gray-400 uppercase tracking-wide">Kunde</span>
                        <span id="session-kunden-display" class="text-xs text-white">-</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs font-semibold text-gray-400 uppercase tracking-wide">Dauer</span>
                        <span id="session-timer" class="text-xs font-semibold text-green-400">0 Min.</span>
                    </div>
                </div>
                <!-- v1.7.2: Educational Modules Status -->
                <div class="p-2 border-b border-gray-700">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wide px-3 py-2">Besprochene
                        Erkl√§rer
                    </div>
                    <div class="px-3 py-2 space-y-2">
                        <div class="flex items-center gap-2">
                            <span id="erklaerer-ca-icon" class="text-gray-600">‚≠ï</span>
                            <span class="text-xs text-gray-400">Cost-Average-Effekt</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span id="erklaerer-sorr-icon" class="text-gray-600">‚≠ï</span>
                            <span class="text-xs text-gray-400">Sequence of Returns Risk</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span id="erklaerer-anleihen-icon" class="text-gray-600">‚≠ï</span>
                            <span class="text-xs text-gray-400">Aktien & Anleihen</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 px-3 mt-2">‚úÖ = im PDF enthalten</p>
                </div>
                <div class="p-2 border-b border-gray-700">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wide px-3 py-2">Auto-Export</div>
                    <div class="px-3 py-2 mb-2">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-gray-400">Automatische Speicherung</span>
                            <label class="switch">
                                <input type="checkbox" id="auto-save-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="flex items-center justify-between text-xs mb-2">
                            <span class="text-gray-400">Zielordner:</span>
                            <span id="auto-export-folder-display" class="font-mono text-xs">
                                <span class="text-gray-400">üì• Download-Ordner</span>
                            </span>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-400">Letzter Export:</span>
                            <span id="auto-export-status" class="font-mono">
                                <span class="text-yellow-400">‚è≥ Wartet...</span>
                            </span>
                        </div>
                        <p id="auto-save-interval-info" class="text-xs text-gray-500 mt-2">Automatisch alle 2 Minuten
                        </p>
                    </div>
                    <button onclick="selectAutoExportDirectory();"
                        class="w-full text-left px-3 py-2 mb-1 text-sm text-mlp-blue hover:bg-blue-900 hover:bg-opacity-30 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                        </svg>
                        Ordner ausw√§hlen
                    </button>
                    <button onclick="exportAsJSON(true); toggleSessionMenu();"
                        class="w-full text-left px-3 py-2 text-sm text-green-400 hover:bg-green-900 hover:bg-opacity-30 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Jetzt exportieren
                    </button>
                </div>
                <div class="p-2 border-b border-gray-700">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wide px-3 py-2">Manueller Export
                    </div>
                    <button onclick="exportAsCSV(); toggleSessionMenu();"
                        class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-tertiary hover:bg-opacity-50 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Als CSV exportieren
                    </button>
                    <button onclick="exportAsJSON(false); toggleSessionMenu();"
                        class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-tertiary hover:bg-opacity-50 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
                        </svg>
                        Als JSON exportieren
                    </button>
                    <button onclick="exportAsExcel(); toggleSessionMenu();"
                        class="w-full text-left px-3 py-2 text-sm text-mlp-blue hover:bg-blue-900 hover:bg-opacity-30 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Als Excel exportieren
                    </button>
                    <button onclick="prepareAndPrint(); toggleSessionMenu();"
                        class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-tertiary hover:bg-opacity-50 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                        </svg>
                        Als PDF drucken
                    </button>
                </div>
                <div class="p-2 border-b border-gray-700">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wide px-3 py-2">Import</div>
                    <button onclick="importSessionBackup(); toggleSessionMenu();"
                        class="w-full text-left px-3 py-2 text-sm text-mlp-blue hover:bg-blue-900 hover:bg-opacity-30 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        Session importieren
                    </button>
                </div>
                <div class="p-2">
                    <button onclick="showSessionEndDialog(); toggleSessionMenu();"
                        class="w-full text-left px-3 py-2 text-sm text-red-400 hover:bg-red-900 hover:bg-opacity-30 rounded transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        Session beenden
                    </button>
                </div>
                <div class="px-3 py-2 border-t border-gray-700">
                    <div class="text-xs text-gray-500 text-center">
                        <span class="font-mono">v1.7.8</span>
                    </div>
                    <div class="text-xs text-gray-600 text-center mt-1">
                        Notfall: <kbd class="text-xs">Ctrl+Shift+E</kbd>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== CONTROL BAR (v1.4.0) ===== -->
        <div id="control-bar">
            <!-- Theme Toggle -->
            <label class="control-bar-item control-bar-item--theme" title="Darstellung wechseln">
                <input type="checkbox" id="theme-switch-bar" aria-label="Theme umschalten (Hell/Dunkel)">
                <span class="bar-icon" aria-hidden="true">
                    <svg class="icon icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="4" />
                        <path d="M12 2v2" />
                        <path d="M12 20v2" />
                        <path d="M4.93 4.93l1.42 1.42" />
                        <path d="M17.65 17.65l1.42 1.42" />
                        <path d="M2 12h2" />
                        <path d="M20 12h2" />
                        <path d="M4.93 19.07l1.42-1.42" />
                        <path d="M17.65 6.35l1.42-1.42" />
                    </svg>
                    <svg class="icon icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79z" />
                    </svg>
                </span>
            </label>

            <!-- Variant Toggle (A/B) -->
            <label class="control-bar-item control-bar-item--variant" title="Variante A/B umschalten">
                <input type="checkbox" id="variant-switch-bar" aria-label="Variante A/B umschalten">
                <span class="bar-pair" aria-hidden="true">
                    <span id="variante-a-label-bar" class="bar-state bar-state--active">A</span>
                    <span id="variante-b-label-bar" class="bar-state">B</span>
                </span>
            </label>

            <!-- Consultation Button -->
            <div class="control-bar-item control-bar-item--consultation" title="Beratung">
                <button id="consult-toggle-btn-bar" class="bar-button" type="button" aria-label="Beratung starten">
                    <svg class="icon icon-mlp" viewBox="0 0 24 24" aria-hidden="true">
                        <circle cx="10" cy="12" r="5.5" stroke="currentColor" stroke-width="1.6" fill="none" />
                        <path d="M10 8.5v7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                        <path d="M18 7h3v10h-3z" fill="currentColor" />
                    </svg>
                </button>
                <button id="consult-next-btn-bar" class="bar-button hidden" type="button"
                    aria-label="Weiter zur naechsten Beratungsphase" title="Weiter zur naechsten Beratungsphase">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14" />
                        <path d="M13 6l6 6-6 6" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- ===== BOOKING FAB (v1.4.0) ===== -->
        <button id="booking-fab" aria-label="Buchungskalender √∂ffnen">
            <span class="fab-label">Buchungskalender</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        </button>

        <!-- Booking Modal -->
        <div id="booking-modal">
            <div class="booking-modal-content">
                <div class="booking-modal-header">
                    <h2>Buchungskalender</h2>
                    <button class="booking-modal-close" onclick="closeBookingModal()" aria-label="Schlie√üen">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="booking-modal-body" id="booking-modal-body">
                    <!-- Content will be moved here from sidebar -->
                </div>
            </div>
        </div>

        <!-- Session Start Dialog (Premium Redesign) -->
        <div id="session-start-dialog" class="modal-overlay">
            <div class="modal-content w-full relative sm:mx-auto" style="max-width: 500px">

                <!-- Sleek Header -->
                <div class="text-center mb-8">
                    <div
                        class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-mlp-blue bg-opacity-10 mb-4 shadow-[0_0_15px_rgba(0,170,230,0.15)]">
                        <svg class="w-6 h-6 text-mlp-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2 tracking-tight">Neuer Flow</h2>
                    <p class="text-sm text-gray-400">Verbindungsaufbau zur lokalen Beratungssession.</p>
                </div>

                <div class="space-y-4 mb-8">
                    <!-- Input Group: K√ºrzel -->
                    <div>
                        <label for="session-kunden-kuerzel" class="block text-sm font-medium text-gray-400 mb-1.5 ml-1">
                            Kundenk√ºrzel (optional)
                        </label>
                        <input type="text" id="session-kunden-kuerzel" placeholder="z.B. MX-2025-001"
                            class="w-full bg-gray-900/50 text-white px-4 py-3 rounded-xl border border-gray-700/50 focus:border-mlp-blue focus:ring-1 focus:ring-mlp-blue focus:outline-none transition-all placeholder-gray-600">
                    </div>

                    <!-- Input Group: Berater -->
                    <div>
                        <label for="session-berater" class="block text-sm font-medium text-gray-400 mb-1.5 ml-1">
                            Berater (optional)
                        </label>
                        <input type="text" id="session-berater" placeholder="Ihr Name"
                            class="w-full bg-gray-900/50 text-white px-4 py-3 rounded-xl border border-gray-700/50 focus:border-mlp-blue focus:ring-1 focus:ring-mlp-blue focus:outline-none transition-all placeholder-gray-600">
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col gap-3">
                    <button onclick="startSessionFromDialog()"
                        class="w-full relative overflow-hidden group bg-mlp-blue hover:brightness-110 text-white font-semibold py-3.5 px-6 rounded-xl transition-all duration-300 shadow-[0_4px_20px_rgba(0,170,230,0.25)] hover:shadow-[0_4px_25px_rgba(0,170,230,0.4)]">
                        <span class="relative z-10 flex items-center justify-center gap-2">
                            Beratung starten
                            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M14 5l7 7m0 0l-7 7m7-7H3" />
                            </svg>
                        </span>
                    </button>

                    <button onclick="importSessionBackup(); closeModal('session-start-dialog');"
                        class="w-full bg-transparent hover:bg-gray-800/50 border border-gray-700 text-gray-300 font-medium py-3 px-6 rounded-xl transition-colors flex items-center justify-center gap-2 text-sm">
                        <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        Backup laden
                    </button>
                </div>

                <!-- Compact Privacy Note -->
                <div id="privacy-notice-box" class="mt-8 pt-5 border-t border-gray-800">
                    <label class="flex items-start gap-3 cursor-pointer group">
                        <div class="relative flex items-center justify-center mt-0.5">
                            <input type="checkbox" id="privacy-understood-checkbox"
                                class="peer appearance-none w-5 h-5 border border-gray-600 rounded bg-gray-800 checked:bg-mlp-blue checked:border-mlp-blue transition-colors cursor-pointer">
                            <svg class="absolute w-3 h-3 text-white opacity-0 peer-checked:opacity-100 pointer-events-none"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <div class="text-xs text-gray-500 leading-relaxed group-hover:text-gray-400 transition-colors">
                            <strong>100% DSGVO-konform:</strong> Alle Daten bleiben offline und werden ausschlie√ülich
                            lokal
                            in Ihrem Browser (sessionStorage) verarbeitet. <span
                                class="text-gray-600 block mt-1">(Diesen
                                Hinweis nicht mehr anzeigen)</span>
                        </div>
                    </label>
                </div>

            </div>
        </div>

        <!-- Session Recovery Dialog -->
        <div id="session-recovery-dialog" class="modal-overlay">
            <div class="modal-content w-full relative sm:mx-auto" style="max-width: 500px">
                <h2 class="text-2xl font-bold text-white mb-4">Vorherige Session gefunden</h2>
                <p class="text-gray-300 mb-4">
                    Eine vorherige Beratungssession wurde gefunden. M√∂chten Sie diese fortsetzen?
                </p>

                <div id="recovery-session-info" class="bg-secondary p-4 rounded-lg mb-6 text-sm text-gray-300">
                    <!-- Wird dynamisch bef√ºllt -->
                </div>

                <div class="flex gap-3">
                    <button onclick="continueSession()"
                        class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        Fortsetzen
                    </button>
                    <button onclick="startNewSessionAndDiscard()"
                        class="flex-1 bg-gray-600 hover:bg-tertiary text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        Neue Session
                    </button>
                </div>
            </div>
        </div>

        <!-- Session End Dialog -->
        <div id="session-end-dialog" class="modal-overlay">
            <div class="modal-content w-full relative sm:mx-auto" style="max-width: 500px">
                <h2 class="text-2xl font-bold text-white mb-4">Beratung beenden?</h2>
                <p class="text-gray-300 mb-6">
                    Alle Daten werden gel√∂scht. M√∂chten Sie vor dem Beenden die Daten exportieren?
                </p>

                <div class="bg-yellow-900 bg-opacity-50 border border-yellow-600 rounded-lg p-4 mb-6">
                    <p class="text-sm text-yellow-200">
                        <strong>Warnung:</strong> Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!
                    </p>
                </div>

                <div class="flex flex-col gap-3">
                    <button onclick="endSession(true)"
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        Exportieren & Beenden
                    </button>
                    <button onclick="endSession(false)"
                        class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        Ohne Export beenden
                    </button>
                    <button onclick="closeModal('session-end-dialog')"
                        class="w-full bg-gray-600 hover:bg-tertiary text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        Abbrechen
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== END SESSION UI ELEMENTS ===== -->

</body>

</html>