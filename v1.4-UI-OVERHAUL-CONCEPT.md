# Version 1.4.0: UI Overhaul - Konzept & Implementierungsplan

**Datum:** 01.11.2025
**Backup Point:** `v1.3.11-stable`
**Ziel:** Flowchart-zentriertes Design ohne Sidebar

---

## ğŸ¯ Vision

**Vorher (v1.3.11):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Planungs-Cockpit]  â”‚    FLOWCHART           â”‚
â”‚  - Einkommen Input  â”‚                         â”‚
â”‚  - Konsum Inputs    â”‚    [Basins]            â”‚
â”‚  - Tagesgeld        â”‚                         â”‚
â”‚  - Depot + Prognose â”‚    [Flows]             â”‚
â”‚  - Buchungskalender â”‚                         â”‚
â”‚  [Theme][A/B][ğŸ“Š]   â”‚                         â”‚
â”‚    (33% Breite)     â”‚     (66% Breite)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Nachher (v1.4.0):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Session]           [ğŸŒ™][Aâ”‚B][ğŸ“Š][â†’]         â”‚ â† Kompakte Top-Bar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚              FULL-WIDTH FLOWCHART              â”‚
â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ Einkommen   â”‚ â† Click Ã¶ffnet Inline-Editor â”‚
â”‚  â”‚   3.000â‚¬ âœï¸ â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚        â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Konsum     â”‚  â”‚ Fixkosten   â”‚ â† Click    â”‚
â”‚  â”‚   100â‚¬/250â‚¬ â”‚  â”‚  1.202â‚¬ ğŸ“  â”‚   Ã¶ffnet   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Modal    â”‚
â”‚                                                â”‚
â”‚  [ğŸ“… Buchungskalender]  â† FAB unten rechts    â”‚
â”‚                           (100% Breite)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Bestandsaufnahme (v1.3.11)

### **Sidebar-Inhalte (zu entfernen):**

#### **1. Einkommen (Sektion)**
- Input: `#income` (3000â‚¬)
- **Aktion:** â†’ Inline-Editor im Einkommen-Basin

#### **2. Konsumkonto (Sektion)**
- Input: `#konsumMin` (100â‚¬)
- Input: `#konsumLeftover` (250â‚¬)
- **Aktion:** â†’ Inline-Editor im Konsum-Basin

#### **3. Tagesgeldkonto (Sektion)**
- Input: `#tagesgeldCurrent` (4800â‚¬)
- Input: `#tagesgeldLimit` (5000â‚¬)
- **Aktion:** â†’ Inline-Editor im Tagesgeld-Basin

#### **4. VermÃ¶gensdepot (Sektion)**
- Input: `#depotCurrent` (25000â‚¬)
- Input: `#anlagezeitraum` (Slider, 15 Jahre)
- Input: `#rendite` (7%)
- Button: "Prognose berechnen"
- Info: Rendite-Empfehlungen
- **Aktion:** â†’ Inline-Editor im Depot-Basin + Auto-Prognose

#### **5. Buchungskalender (Sektion)**
- Booking-Type-Buttons
- Kalender-Grid (30 Tage)
- "Plan leeren" Button
- **Aktion:** â†’ FAB (Floating Action Button) + Vollbild-Modal

### **Header-Controls (zu verschieben):**

#### **Panel-Controls (3 Chips):**
1. Theme-Toggle (ğŸŒ™/â˜€ï¸)
2. Variante-Toggle (A|B)
3. Beratungsmodus-Toggle (ğŸ“Š) + Next (â†’)

**Aktuell:** In `.panel-controls` im Sidebar-Header
**Neu:** Rechts oben als `.control-bar` (fixed)

---

## ğŸ¨ Design-Guidelines Compliance

### **Von SKILL.md Ã¼bernommen:**

1. **âœ… 8px Grid System**
   - Control-Bar: 8px gap, 16px padding
   - Basin spacing: 24px
   - Section gaps: 32px

2. **âœ… Clean & Minimal**
   - Sidebar-Clutter entfernen
   - Fokus auf Flowchart
   - Weniger visuelle KomplexitÃ¤t

3. **âœ… Single Accent Color**
   - MLP Blue (#002F6C) fÃ¼r primary actions
   - Grays fÃ¼r neutral elements
   - **KEINE** neuen Gradient-Backgrounds

4. **âœ… Touch Targets (44px minimum)**
   - Control-Bar Buttons: 44px height
   - FAB: 56px (Standard)
   - Inline-Editor Buttons: 44px

5. **âœ… Subtle Shadows**
   - Control-Bar: `box-shadow: 0 1px 3px rgba(0,0,0,0.12)`
   - FAB: `box-shadow: 0 4px 12px rgba(0,0,0,0.3)`
   - **KEINE** heavy shadows

6. **âœ… Border Radius**
   - Control-Bar: 12px
   - Buttons: 8px
   - FAB: 50% (circle)

7. **âœ… Typography**
   - Body: 16px minimum
   - Basin values: 16-18px
   - Inline inputs: 16px

8. **âœ… Interactive States**
   - Hover: Subtle bg change
   - Active: Darker
   - Focus: Visible outline
   - Disabled: 0.5 opacity

---

## ğŸ—ï¸ Neue Komponenten

### **1. Control-Bar (Top Right)**

**Position:** `fixed`, `top: 1rem`, `right: 1rem`, `z-index: 90`

**Struktur:**
```html
<div class="control-bar">
  <!-- Theme Toggle -->
  <button class="control-btn control-btn--theme"
          aria-label="Theme umschalten">
    <svg class="icon-sun">...</svg>
    <svg class="icon-moon">...</svg>
  </button>

  <!-- Variant Toggle -->
  <div class="variant-toggle-compact">
    <button class="variant-btn active">A</button>
    <button class="variant-btn">B</button>
  </div>

  <!-- Consultation Mode -->
  <button class="control-btn control-btn--consult"
          aria-label="Beratungsmodus">
    ğŸ“Š
  </button>

  <!-- Next Step (hidden by default) -->
  <button class="control-btn control-btn--next hidden"
          aria-label="NÃ¤chster Schritt">
    â†’
  </button>
</div>
```

**CSS (8px Grid, Design Guidelines):**
```css
.control-bar {
  position: fixed;
  top: 16px;           /* 2 Ã— 8px */
  right: 16px;
  display: flex;
  gap: 8px;            /* 1 Ã— 8px */
  z-index: 90;
  background: rgba(31, 41, 55, 0.95);
  backdrop-filter: blur(8px);
  padding: 8px;        /* 1 Ã— 8px */
  border-radius: 12px; /* Design Guide: pronounced */
  border: 1px solid #374151;
  box-shadow: 0 1px 3px rgba(0,0,0,0.12); /* Subtle */
}

.control-btn {
  min-width: 44px;     /* Touch target */
  height: 44px;        /* Touch target */
  padding: 12px;       /* (44-20)/2 fÃ¼r 20px icon */
  background: #1f2937;
  border: 1px solid #374151;
  border-radius: 8px;  /* Design Guide: moderate */
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.control-btn:hover {
  background: #374151;  /* Slightly darker */
  border-color: #4f46e5; /* Accent on hover */
}

.control-btn:active {
  background: #4b5563;
}

.control-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.variant-toggle-compact {
  display: flex;
  gap: 0;
  border-radius: 8px;
  overflow: hidden;
}

.variant-btn {
  min-width: 44px;
  height: 44px;
  padding: 12px 16px; /* 1.5 Ã— 8px, 2 Ã— 8px */
  background: #1f2937;
  border: 1px solid #374151;
  color: #9ca3af;
  font-weight: 600;
  transition: all 0.2s;
}

.variant-btn.active {
  background: #4f46e5; /* MLP Accent */
  border-color: #4f46e5;
  color: white;
}

.variant-btn:hover:not(.active) {
  background: #374151;
  color: white;
}

/* Mobile: Stack vertically */
@media (max-width: 768px) {
  .control-bar {
    top: 72px; /* Below fixed session button */
    flex-direction: column;
  }
}
```

---

### **2. Inline-Editor (fÃ¼r einfache Basins)**

**Beispiel: Einkommen-Basin**

**HTML:**
```html
<button id="einkommen-basin" class="account-basin account-basin--editable">
  <div class="basin-header">
    <div class="basin-label">Einkommen</div>
    <button class="basin-edit-trigger"
            onclick="editBasin('einkommen')"
            aria-label="Einkommen bearbeiten">
      âœï¸
    </button>
  </div>

  <div class="basin-value" id="einkommen-value">
    3.000 â‚¬
  </div>

  <!-- Inline Editor (hidden by default) -->
  <div id="einkommen-editor" class="inline-editor" style="display:none">
    <div class="inline-editor-field">
      <span class="input-prefix">â‚¬</span>
      <input type="number"
             id="income-inline"
             value="3000"
             class="inline-input" />
    </div>
    <div class="inline-editor-actions">
      <button class="inline-btn inline-btn--save"
              onclick="saveBasinInline('einkommen')"
              aria-label="Speichern">
        âœ“
      </button>
      <button class="inline-btn inline-btn--cancel"
              onclick="cancelBasinInline('einkommen')"
              aria-label="Abbrechen">
        âœ—
      </button>
    </div>
  </div>
</button>
```

**CSS:**
```css
.account-basin--editable {
  cursor: pointer;
  position: relative;
}

.account-basin--editable:hover {
  border-color: #4f46e5; /* Accent */
}

.basin-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px; /* 1 Ã— 8px */
}

.basin-edit-trigger {
  width: 32px;  /* 4 Ã— 8px */
  height: 32px;
  background: transparent;
  border: none;
  color: #9ca3af;
  font-size: 16px;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s;
}

.account-basin--editable:hover .basin-edit-trigger {
  opacity: 1;
}

.basin-value {
  font-size: 24px; /* H3 size */
  font-weight: 700;
  color: white;
}

.inline-editor {
  position: absolute;
  inset: 0;
  background: rgba(17, 24, 39, 0.98);
  backdrop-filter: blur(8px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 16px; /* 2 Ã— 8px */
  padding: 24px; /* 3 Ã— 8px */
  z-index: 20;
  border-radius: inherit;
}

.inline-editor-field {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #1f2937;
  border: 2px solid #4f46e5; /* Accent */
  border-radius: 8px;
  padding: 8px 16px; /* 1 Ã— 8px, 2 Ã— 8px */
}

.inline-input {
  width: 120px;
  background: transparent;
  border: none;
  color: white;
  font-size: 20px;
  font-weight: 600;
  text-align: right;
}

.inline-input:focus {
  outline: none;
}

.inline-editor-actions {
  display: flex;
  gap: 8px; /* 1 Ã— 8px */
}

.inline-btn {
  min-width: 44px; /* Touch target */
  height: 44px;
  border-radius: 8px;
  border: 1px solid;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.2s;
}

.inline-btn--save {
  background: #10b981; /* Green */
  border-color: #10b981;
  color: white;
}

.inline-btn--save:hover {
  background: #059669;
}

.inline-btn--cancel {
  background: #ef4444; /* Red */
  border-color: #ef4444;
  color: white;
}

.inline-btn--cancel:hover {
  background: #dc2626;
}
```

**JavaScript:**
```javascript
function editBasin(basinName) {
  const basin = document.getElementById(`${basinName}-basin`);
  const editor = document.getElementById(`${basinName}-editor`);
  const valueDisplay = document.getElementById(`${basinName}-value`);
  const input = editor.querySelector('.inline-input');

  // Hide value, show editor
  valueDisplay.style.opacity = '0';
  editor.style.display = 'flex';

  // Focus input
  input.focus();
  input.select();
}

function saveBasinInline(basinName) {
  const editor = document.getElementById(`${basinName}-editor`);
  const input = editor.querySelector('.inline-input');
  const valueDisplay = document.getElementById(`${basinName}-value`);

  // Update global variable (mapping needed)
  const inputMapping = {
    'einkommen': 'income',
    // ... more mappings
  };

  const globalInputId = inputMapping[basinName];
  if (inputs[globalInputId]) {
    inputs[globalInputId].value = input.value;
  }

  // Update display
  valueDisplay.textContent = formatCurrency(input.value);

  // Hide editor
  editor.style.display = 'none';
  valueDisplay.style.opacity = '1';

  // Recalculate
  calculateAndUpdate();

  // Save session
  saveSessionSnapshot();

  // Toast feedback
  showToast(`${basinName} aktualisiert`, 'success', 2000);
}

function cancelBasinInline(basinName) {
  const editor = document.getElementById(`${basinName}-editor`);
  const valueDisplay = document.getElementById(`${basinName}-value`);

  // Reset input to original value
  const input = editor.querySelector('.inline-input');
  const inputMapping = { 'einkommen': 'income' };
  const globalInputId = inputMapping[basinName];
  input.value = inputs[globalInputId]?.value || 0;

  // Hide editor
  editor.style.display = 'none';
  valueDisplay.style.opacity = '1';
}
```

---

### **3. FAB fÃ¼r Buchungskalender**

**HTML:**
```html
<button class="fab fab--calendar"
        onclick="openModal('booking-modal')"
        aria-label="Buchungskalender Ã¶ffnen">
  ğŸ“…
</button>
```

**CSS:**
```css
.fab {
  position: fixed;
  bottom: 24px; /* 3 Ã— 8px */
  right: 24px;
  width: 56px;  /* Standard FAB size */
  height: 56px;
  border-radius: 50%;
  border: none;
  background: #4f46e5; /* MLP Accent */
  color: white;
  font-size: 24px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Elevated */
  z-index: 80;
  transition: transform 0.2s, box-shadow 0.2s;
}

.fab:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
}

.fab:active {
  transform: scale(1.05);
}

/* Mobile: Position above mobile controls */
@media (max-width: 768px) {
  .fab {
    bottom: 88px; /* Above potential mobile nav */
  }
}
```

---

## ğŸ”„ Migration-Plan: Basins

### **Basin-Typen & Interaktion:**

| Basin | Typ | Interaktion | Fields |
|-------|-----|-------------|--------|
| **Einkommen** | Simple | Inline-Editor | income (â‚¬) |
| **Konsum** | Medium | Inline-Editor (2 Fields) | konsumMin (â‚¬), konsumLeftover (â‚¬) |
| **Fixkosten** | Complex | Modal (wie bisher) | fixkostenItems[] |
| **Tagesgeld** | Medium | Inline-Editor (2 Fields) | tagesgeldCurrent (â‚¬), tagesgeldLimit (â‚¬) |
| **Depot** | Complex | Modal (wie bisher) | depotCurrent, anlagezeitraum, rendite, depotItems[] |
| **Immobilien** | Complex | Modal (wie bisher) | immobilienData[] |
| **Vermieterkonto** | Complex | Modal (wie bisher) | vermieterkontoData{} |

**Inline-Editor:** Einkommen, Konsum, Tagesgeld
**Modal:** Fixkosten, Depot, Immobilien, Vermieterkonto (unverÃ¤ndert)

---

## âš¡ Auto-Prognose

**Aktuell:** Button "Prognose berechnen"
**Neu:** Auto-Update bei jeder Ã„nderung (debounced)

**Implementierung:**
```javascript
// Debounce helper (500ms delay)
function debounce(func, wait) {
  let timeout;
  return function(...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), wait);
  };
}

// Debounced projection update
const debouncedProjection = debounce(calculateProjection, 500);

// Call in calculateAndUpdate()
function calculateAndUpdate() {
  // ... existing calculations ...

  // Auto-update projection (throttled)
  debouncedProjection();
}
```

**Vorteil:** User sieht sofort Effekt seiner Ã„nderungen
**Performance:** Max. 1 Update pro 500ms

---

## ğŸ“ Layout-Ã„nderungen

### **Vorher (v1.3.11):**
```html
<div class="flex flex-col lg:flex-row gap-8">
  <aside class="w-full lg:w-1/3 xl:max-w-lg">
    <!-- Sidebar with all inputs -->
  </aside>
  <div id="flow-container" class="w-full lg:flex-grow">
    <!-- Flowchart -->
  </div>
</div>
```

### **Nachher (v1.4.0):**
```html
<div class="flow-layout">
  <!-- Control Bar (fixed, top-right) -->
  <div class="control-bar">...</div>

  <!-- Full-width Flowchart -->
  <div id="flow-container" class="flow-container-fullwidth">
    <!-- Flowchart with inline-editable basins -->
  </div>

  <!-- FAB for Booking Calendar -->
  <button class="fab fab--calendar">ğŸ“…</button>
</div>
```

**CSS:**
```css
.flow-layout {
  width: 100%;
  max-width: 1400px; /* Design Guide: max-width */
  margin: 0 auto;
  padding: 24px; /* 3 Ã— 8px */
}

.flow-container-fullwidth {
  width: 100%;
  min-height: 1150px;
  position: relative;
}

@media (max-width: 768px) {
  .flow-layout {
    padding: 16px; /* 2 Ã— 8px */
  }
}
```

---

## ğŸ“¦ Removed Components

Diese Elemente werden **komplett entfernt**:

1. **âœ‚ï¸ `<aside class="planning-panel">`** (gesamte Sidebar)
2. **âœ‚ï¸ `.panel-header`** (Header mit Controls)
3. **âœ‚ï¸ `.panel-controls`** (Theme/Variant/Consult Chips)
4. **âœ‚ï¸ `.panel-section`** (alle 5 Sektionen)
5. **âœ‚ï¸ `#sec-income`** (Einkommen-Sektion)
6. **âœ‚ï¸ `#sec-konsum`** (Konsum-Sektion)
7. **âœ‚ï¸ `#sec-tagesgeld`** (Tagesgeld-Sektion)
8. **âœ‚ï¸ `#sec-prognose`** (Depot-Sektion)
9. **âœ‚ï¸ `#sec-booking-plan`** (Buchungskalender-Sektion)
10. **âœ‚ï¸ Button "Prognose berechnen"**

---

## âœ… Phase 1 Complete - Next Steps

**Phase 2:** Top-Bar Implementierung (2-3h)
**Phase 3:** Basin Inline-Editing (6-8h)
**Phase 4:** Buchungskalender FAB (3-4h)
**Phase 5:** Auto-Prognose (2-3h)
**Phase 6:** Testing & Polish (3-4h)

**Gesamtaufwand:** 17-24 Stunden (~3-4 Arbeitstage)

---

## ğŸ”„ Rollback-Strategie

Bei Problemen:
```bash
git checkout v1.3.11-stable
git checkout -b restore-from-v1.4-issues
git push origin restore-from-v1.4-issues
```

Dann deploy von `restore-from-v1.4-issues` Branch.

---

**Bereit fÃ¼r Phase 2?** ğŸš€
